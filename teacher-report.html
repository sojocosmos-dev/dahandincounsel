<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>상담 준비 다했니?</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="teacher-page">

    <div class="page-header">
        <h1>상담 준비 다했니?</h1>
    </div>

    <!-- API Key는 URL 파라미터로 전달되어 자동으로 저장됨 -->
    <input type="hidden" id="api-key-input">

    <!-- 상담 목록 (전체 화면) -->
    <div id="counsel-list-view" class="counsel-list-view">
        <div class="counsel-list-header">
            <h2>📚 상담 목록</h2>
            <div style="display: flex; gap: 10px;">
                <button id="create-counsel-btn" class="btn-create-counsel" onclick="handleCreateCounsel()">
                    ➕ 새 상담 만들기
                </button>
            </div>
        </div>
        <div id="counsel-list-container" class="counsel-list-container">
            <p class="empty-counsel-message">아직 생성된 상담이 없습니다.<br>"➕ 새 상담 만들기" 버튼을 눌러 상담을 만들어보세요.</p>
        </div>
    </div>

    <!-- 상담 입력 폼 (처음엔 숨김) -->
    <div id="counsel-form-view" class="counsel-form-view" style="display: none;">
        <div class="counsel-form-header">
            <button class="btn-back-to-list" onclick="handleBackToList()">← 목록으로</button>
            <div id="current-counsel-info" class="current-counsel-info">
                <span id="current-counsel-title"></span>
                <button class="btn-delete-counsel" onclick="handleDeleteCurrentCounsel()">🗑️ 삭제</button>
            </div>
        </div>

            <div id="input-area">
                <div class="config-section" style="background-color: #e3f2fd; border-color: #2196f3;">
                    <h3>ℹ️ 안내</h3>
                    <p style="font-size: 0.95em; color: #555; line-height: 1.6;">
                        아래 입력한 <strong>보고서 항목 설정</strong>은 학생들이 개인 코드로 로그인했을 때 사용됩니다.<br>
                        설정을 완료한 후 <strong>"💾 상담 저장"</strong> 버튼을 눌러 저장하세요.<br>
                        <em style="color: #1976d2;">※ 향후 데이터베이스 연동 예정</em>
                    </p>
                </div>

                <div class="config-section" style="background-color: #fff3e0; border-color: #ff9800;">
                    <h3>📝 상담 제목</h3>
                    <input type="text" id="counsel-title-input" placeholder="예: 2024년 1학기 상담" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 1em;">
                </div>

                <div id="mode-content-area">
            
            
            <div class="config-section" style="background-color: #e8f5e9; border-color: #66bb6a;">
                <h3>✅ 필수 입력: 우리 학급의 다했니 다했어요 활용 방안</h3>
                <p style="font-size: 0.9em; color: #777;">* 수정해서 입력 가능합니다.</p>
                <textarea id="input-usage-general" rows="3" placeholder="예시: 우리 학급은 다했니 다했어요를 태블릿 활용 수업의 메인 플랫폼으로 사용했습니다. 학생들은 학급 생활, 수업 참여, 과제 수행 등에 따라 쿠키, 초코칩, 뱃지를 획득했습니다." required></textarea>
            </div>


            <div class="config-section">
                <h3>📋 성장 기록 보고서 출력 항목 선택</h3>
                <p style="font-size: 0.9em; color: #777;">* 항목을 체크하면 관련 활용 방안 입력란이 활성화됩니다. 하위 항목까지 선택 가능합니다.</p>
                
                <div class="output-option-group" id="option-group-cookie">
                    <label>
                        <input type="checkbox" id="check-output-cookie" checked onchange="toggleConfigGroup('cookie')">
                        🍪 쿠키 활동 전체 출력
                    </label>
                    
                    <div id="cookie-config-details" class="sub-options">
                        <label>
                            <input type="checkbox" id="check-output-cookie-usage" checked>
                            우리 학급 쿠키 획득 및 사용
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-cookie-asset" checked>
                            쿠키 자산 현황 (수입/지출/잔여)
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-cookie-review" checked>
                            나의 쿠키 활동 돌아보기 (학생 입력칸)
                        </label>
                        
                        <p style="font-size: 0.9em; color: #777; margin-top: 10px;">* 획득/사용 내용을 구분해서 입력해야 합니다. (예: 획득: ..., 사용: ...)</p>
                        <textarea id="input-cookie-usage" rows="4" placeholder="획득: 주제글쓰기 제출 2쿠키, 받아쓰기 1쿠키~3쿠키, 놀이마당 1쿠키~2쿠키, 1인 1역 월급 7쿠키~15쿠키.&#10;사용: 자리 선택권 20쿠키, 간식교환 5쿠키~10쿠키, 음악재생권 10쿠키."></textarea>
                    </div>
                </div>

                <div class="output-option-group" id="option-group-chip">
                    <label>
                        <input type="checkbox" id="check-output-chip" checked onchange="toggleConfigGroup('chip')">
                        🍫 초코칩 활동 전체 출력
                    </label>
                    
                    <div id="chip-config-details" class="sub-options">
                        <label>
                            <input type="checkbox" id="check-output-chip-usage" checked>
                            우리 학급 초코칩 획득 및 사용
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-chip-asset" checked>
                            초코칩 자산 현황 (잔액)
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-chip-review" checked>
                            나의 초코칩 활동 돌아보기 (학생 입력칸)
                        </label>

                        <p style="font-size: 0.9em; color: #777; margin-top: 10px;">* 획득/사용 내용을 구분해서 입력해야 합니다. (예: 획득: ..., 사용: ...)</p>
                        <textarea id="input-chip-usage" rows="4" placeholder="획득: 발표 내용이 좋은 학생에게 1초코칩, 경청 태도가 좋은 학생에게 1초코칩.&#10;사용: 10초코칩을 1쿠키로 교환할 수 있음."></textarea>
                    </div>
                </div>

                <div class="output-option-group" id="option-group-badge">
                    <label>
                        <input type="checkbox" id="check-output-badge" checked onchange="toggleConfigGroup('badge')">
                        🏅 뱃지 활동 전체 출력
                    </label>
                    
                    <div id="badge-config-details" class="sub-options">
                        <label>
                            <input type="checkbox" id="check-output-badge-usage" checked>
                            우리 학급 뱃지 소개 및 획득
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-badge-status" checked>
                            학생의 뱃지 획득 현황
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-badge-strength" style="display: none;">
                        </label>

                        <p style="font-size: 0.9em; color: #777; margin-top: 10px;">* 소개/획득 내용을 구분해서 입력해야 합니다. (예: 소개: ..., 획득: ...)</p>
                        <textarea id="input-badge-usage" rows="4" placeholder="소개: 아침 독서, 바르게 글씨 쓰기, 인사 잘하기, 환경보호 실천하기, 마음 다스리기, 효도미션.&#10;획득: 아침 한 줄 독서록 쓰기 완성, 바른 글씨 칭찬 10회 이상, 매달 학급회의 시간 인사왕 뽑기, 제로웨이스트 미션 통과, 현명하게 갈등 해결하기 5회, 효도 미션통과."></textarea>
                    </div>
                </div>
                
                <div class="output-option-group" id="option-group-summary" style="background-color: #fce4ec; border-color: #ec407a;">
                    <label>
                        <input type="checkbox" id="check-output-summary" checked onchange="toggleConfigGroup('summary', false)">
                        📊 총평 섹션 전체 출력
                    </label>
                    <div id="summary-config-details" class="sub-options">
                        <label>
                            <input type="checkbox" id="check-output-summary-summary" checked style="display: none;"> 
                            활동 요약 (자동 입력)
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-summary-strength" checked>
                            칭찬과 다짐 (학생 입력칸)
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-summary-parent" checked>
                            격려의 한 마디 (학부모 입력칸)
                        </label>

                        <p style="font-size: 0.85em; color: #a1887f; margin-top: 10px;">
                            * **활동 요약**은 자동으로 입력되며, **칭찬과 다짐**은 학생, **격려의 한 마디**는 학부모님께서 작성하는 항목입니다.
                        </p>
                    </div>
                </div>

            </div>
        </div>

            <div class="button-group">
                <button id="save-counsel-btn" onclick="handleSaveCounsel()">💾 상담 저장</button>
            </div>
        </div>

        <div id="message-area">
            <p class="alert alert-info">상담 제목과 보고서 항목을 입력하고 저장하면, 학생들이 해당 상담을 선택하여 성장 기록표를 조회할 수 있습니다.</p>
        </div>
    </div>

    <!-- 스낵바 -->
    <div id="snackbar" class="snackbar"></div>

    <!-- 뒤로 가기 버튼 -->
    <div class="page-footer">
        <button class="btn-back-to-login" onclick="goBackToLogin()">← 로그인 화면으로 돌아가기</button>
    </div>

    <!-- Firebase 설정 (NPM 모듈 방식) -->
    <script type="module" src="src/firebase/firebase-config.js"></script>

    <!-- 기본 설정 및 서비스 -->
    <script defer src="src/core/config.js"></script>
    <script defer src="src/services/config-storage-service.js"></script>
    <script defer src="src/services/counsel-storage-service.js"></script>
    <script defer src="src/services/student-submission-service.js"></script>
    <script defer src="src/core/state-manager.js"></script>
    <script defer src="src/core/api-manager.js"></script>
    <script defer src="src/utils/text-utility.js"></script>
    <script defer src="src/services/report-data-generator.js"></script>
    <script defer src="src/services/report-section-generator.js"></script>
    <script defer src="src/services/report-generator.js"></script>
    <script defer src="src/ui/ui-controller.js"></script>
    <script defer src="src/services/report-service.js"></script>
    <script defer src="src/ui/counsel-manager.js"></script>
    <script defer src="src/apps/teacher-app.js"></script>

    <script>
        // 로그인 화면으로 돌아가기 함수
        function goBackToLogin() {
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
