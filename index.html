<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìƒë‹´ ì¤€ë¹„ ë‹¤í–ˆë‹ˆ? ì„±ì¥ ê¸°ë¡</title>
    <style>
        /* (ê¸°ë³¸ ìŠ¤íƒ€ì¼ ìœ ì§€) */
        body { font-family: 'Malgun Gothic', 'Arial', sans-serif; max-width: 1000px; margin: 20px auto; padding: 0 20px; background-color: #f8f8f8; }
        input[type="text"], textarea, input[type="file"] { 
            padding: 10px; margin: 8px 0; width: 100%; box-sizing: border-box; font-size: 16px; border-radius: 4px; border: 1px solid #ddd; resize: vertical; 
        }

        .button-group button { padding: 12px 20px; margin: 5px; background-color: #2ecc71; color: white; border: none; cursor: pointer; border-radius: 6px; transition: background-color 0.3s; }
        .button-group button:hover { background-color: #27ae60; }
        .print-download-group button { 
            background-color: #3498db; 
            padding: 10px 18px; 
            font-size: 1em;
            margin: 5px;
        }
        .print-download-group button:hover { background-color: #2980b9; }
        .button-group, .print-download-group { text-align: center; margin-bottom: 20px; margin-top: 20px; }
        
        /* 1-3. ì…ë ¥ UI ìŠ¤íƒ€ì¼ (ì¹¸ í¬ê¸° ë¹„ìœ¨ ì¡°ì •/ì—¬ë°± ì¶•ì†Œ) */
        #input-area { background-color: #ffffff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .config-section { margin-top: 15px; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px; background-color: #fefefe; }
        .output-option-group { 
            display: flex; flex-direction: column; 
            margin-bottom: 10px; 
            padding: 8px; 
            border: 1px solid #b3e5fc; 
            border-radius: 4px; 
            background-color: #e1f5fe;
        }

        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .mode-selection { display: flex; margin-bottom: 15px; border-bottom: 2px solid #ddd; }
        .mode-tab { flex: 1; padding: 10px 0; text-align: center; cursor: pointer; border-bottom: 2px solid transparent; font-weight: bold; color: #777; transition: all 0.3s; }
        .mode-tab.active { border-bottom: 2px solid #2ecc71; color: #2ecc71; background-color: #e8f5e9; }
        
        /* ë³´ê³ ì„œ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        #report-area { 
            background-color: #ffffff; border-radius: 12px; 
            padding: 40px; 
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1); 
            margin-top: 30px; 
        }
        h1 { 
            color: #4a4a4a; text-align: center; font-size: 2.5em; border-bottom: 3px solid #ff9800; padding-bottom: 15px; margin-bottom: 10px; 
            display: flex; justify-content: center; align-items: center; white-space: nowrap;
        }
        
        /* í™œìš© ë°©ì•ˆ ì„¹ì…˜ */
        .usage-section { 
            background-color: #fff8e1; 
            padding: 10px 15px; 
            border-radius: 8px; 
            margin-bottom: 15px; 
            border-left: 5px solid #ffc107; 
        }
        
        /* ì´í‰ ì„¹ì…˜ (2-3. í¬ê¸° ì¤„ì´ê¸° ë°˜ì˜) */
        .summary-section { 
            background-color: #e0f7fa; 
            border: 2px solid #00bcd4; 
            padding: 15px; 
            border-radius: 8px; 
            margin-top: 20px; 
        }
        .summary-section h2 { 
            color: #00838f; 
            font-size: 1.5em; 
            margin-top: 0; 
            margin-bottom: 10px; 
        }
        .summary-section h3 { 
            color: #00bcd4; 
            font-size: 1.2em; 
            margin-top: 10px; 
            margin-bottom: 8px; 
        }
        .summary-textarea { 
            width: 100%; 
            min-height: 80px; 
            padding: 10px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            resize: vertical; 
            font-size: 1em;
            box-sizing: border-box;
        }

        /* ì‚¼ë¶„í• /ì´ë¶„í• /ë‹¨ì¼ ë¶„í•  ë ˆì´ì•„ì›ƒ (2-3. ì—¬ë°± ì¶•ì†Œ ë°˜ì˜) */
        .asset-section-container { 
            margin-bottom: 20px; 
            padding: 10px; 
            border: 1px solid #f0f0f0; 
            border-radius: 8px; 
        }
        
        .activity-title { 
            font-size: 1.4em; 
            font-weight: bold; 
            color: #1e88e5; 
            margin-top: 25px; 
            margin-bottom: 15px; 
            border-bottom: 2px solid #bbdefb; 
            padding-bottom: 5px;
        }

        .dynamic-column-layout {
            display: flex;
            gap: 15px; 
            margin-top: 10px;
        }
        .dynamic-column-layout > div {
            /* 2-1. ì¹¸ í¬ê¸° ëŠ˜ë¦¬ê¸°ë¥¼ ìœ„í•´ flex-direction ì¶”ê°€ */
            display: flex;
            flex-direction: column;
            
            padding: 8px; 
            border: 1px dashed #e0e0e0;
            border-radius: 4px;
            min-height: 220px; 
            box-sizing: border-box;
        }
        
        .column-title { 
            font-weight: bold; 
            color: #333; 
            margin-bottom: 10px; 
            border-bottom: 1px solid #f0f0f0; 
            padding-bottom: 5px;
        }

        /* ì¿ í‚¤ í˜„í™© */
        .center-asset-content { text-align: center; }
        .cookie-asset-info { margin-top: 10px; font-size: 0.9em; text-align: left; padding: 0 15px; }
        .cookie-asset-info strong { display: block; margin-bottom: 5px; font-size: 1em; }
        .cookie-asset-item { display: flex; justify-content: space-between; margin-bottom: 5px; padding: 3px 0; border-bottom: 1px dotted #eee; }

        /* í•™ìƒ ëŒì•„ë³´ê¸° ìŠ¤íƒ€ì¼ */
        .student-review-area {
            /* 2-1. ì¹¸ í¬ê¸° ëŠ˜ë¦¬ê¸°ë¥¼ ìœ„í•´ flex ì†ì„± ì¶”ê°€ */
            flex-grow: 1; 
            display: flex;
            flex-direction: column;
            justify-content: space-between; 
        }
        .student-review-area textarea { 
            /* 2-1. ì¹¸ í¬ê¸° ëŠ˜ë¦¬ê¸°ë¥¼ ìœ„í•´ flex ì†ì„± ë° min-height 0 ì„¤ì • */
            flex-grow: 1; 
            min-height: 0; 
            
            font-size: 0.95em; 
            padding: 8px; 
            margin: 0 0 10px 0; /* í…ìŠ¤íŠ¸ ì—ì–´ë¦¬ì–´ ê°„ê²© í™•ë³´ */
            box-sizing: border-box; 
            border: 1px solid #ccc; 
            border-radius: 4px;
        }
        .student-review-area textarea:last-child {
            /* 2-1. ë§ˆì§€ë§‰ í…ìŠ¤íŠ¸ ì—ì–´ë¦¬ì–´ í•˜ë‹¨ ì—¬ë°± ì œê±° */
            margin-bottom: 0;
        }
        
        /* ì¿ í‚¤ ì›í˜• ê·¸ë˜í”„ ìŠ¤íƒ€ì¼ */
        .graph-container { display: flex; justify-content: center; align-items: center; margin-top: 10px; }
        .pie-chart { 
            width: 120px; height: 120px; border-radius: 50%; 
            position: relative;
            display: flex; align-items: center; justify-content: center; 
            flex-shrink: 0; 
        }
        
        /* ë±ƒì§€ í¬íŠ¸í´ë¦¬ì˜¤ ìŠ¤íƒ€ì¼ */
        .all-badges-container { 
            display: flex; flex-wrap: wrap; 
            gap: 10px; 
            padding: 10px 0; 
            justify-content: center; 
        }
        .badge-item-display { 
            width: 80px; 
            text-align: center; 
            font-size: 0.85em; 
            line-height: 1.2; 
        }
        .badge-item-display span { 
            display: block; 
            white-space: normal; 
            overflow-wrap: break-word; 
            word-wrap: break-word;
        }
        .badge-item-display img { 
            width: 50px; height: 50px; margin-bottom: 3px; border-radius: 50%; object-fit: cover; 
            border: 3px solid #2ecc71; 
            box-shadow: 0 0 5px rgba(46, 204, 113, 0.5); 
        }

        /* ì¡°íšŒ ì¼ì‹œë¥¼ ê¼¬ë¦¬ë§ ë¶€ë¶„ì— ìƒì„± */
        .report-footer {
            text-align: right; 
            margin-top: 30px; 
            padding-top: 8px; 
            border-top: 1px solid #ddd; 
            color: #777; 
            font-size: 0.85em;
        }

        /* 2-2. ì¸ì‡„ ì‹œ ìµœì í™” (A4 í•œ ì¥ì— ë§ì¶”ê¸°) */
        @media print {
            body { 
                padding: 0; margin: 0; 
                /* 3-2. í°íŠ¸ í¬ê¸° ì¡°ì • */
                font-size: 8.5pt; /* 9ptì—ì„œ ë” ì¤„ì„ */
            }
            
            /* 3-1. ì œëª© 'ìƒë‹´ ì¤€ë¹„ ë‹¤í–ˆë‹ˆ?' ì œê±° */
            body > h1:first-of-type { 
                display: none; 
            }
            
            #input-area, .button-group, .print-download-group { display: none; }
            #report-area { 
                box-shadow: none; 
                padding: 3mm 4mm; /* 3-2. íŒ¨ë”© ì¶•ì†Œ (5mm 5mmì—ì„œ) */
                margin: 0; 
                border-radius: 0; 
                background-color: white;
            }
            /* 3-2. ë³´ê³ ì„œ ë‚´ ì œëª© í¬ê¸° ë° ì—¬ë°± ì¡°ì • */
            #report-area h1 { font-size: 1.6em; padding-bottom: 6px; margin-bottom: 3px; }
            
            /* ì—¬ë°± ë° í¬ê¸° ì¡°ì • */
            /* 3-2. ì„¹ì…˜ ë§ˆì§„/íŒ¨ë”© ì¶•ì†Œ */
            .usage-section, .asset-section-container, .summary-section { 
                margin-bottom: 3px; /* 5pxì—ì„œ ì¤„ì„ */
                padding: 4px; /* 5pxì—ì„œ ì¤„ì„ */
                page-break-inside: avoid; 
            }
            
            /* Column Layout Reduction */
            /* 3-2. ì»¬ëŸ¼ ê°„ê²©/ë§ˆì§„ ì¶•ì†Œ */
            .dynamic-column-layout { gap: 6px; margin-top: 5px; } 
            .dynamic-column-layout > div { 
                min-height: 140px; /* 150pxì—ì„œ ì¤„ì„ */
                padding: 3px; /* 4pxì—ì„œ ì¤„ì„ */
                font-size: 0.85em;
            }
            .column-title { font-size: 0.9em; margin-bottom: 5px; }
            .activity-title { margin-top: 10px; margin-bottom: 8px; font-size: 1.2em; }
            
            /* ì´í‰ í•­ëª© í¬ê¸° ì¡°ì • */
            .summary-section { 
                padding: 8px; 
                margin-top: 10px; /* 15pxì—ì„œ ì¤„ì„ */
            }
            .summary-section h3 {
                margin-top: 8px; 
                margin-bottom: 3px;
                font-size: 1.05em; /* 1.1emì—ì„œ ì¤„ì„ */
            }
            .summary-textarea { 
                min-height: 50px; 
                font-size: 0.9em;
            }
            .auto-summary-area {
                padding: 8px; 
                font-size: 0.9em; /* 0.95emì—ì„œ ì¤„ì„ */
            }
            
            /* ëŒì•„ë³´ê¸° í…ìŠ¤íŠ¸ í¬ê¸° ì¡°ì • */
            .student-review-area label { margin-top: 5px; margin-bottom: 3px; font-size: 0.85em; }
            .student-review-area textarea { 
                min-height: 40px; /* 45pxì—ì„œ ì¤„ì„ */
                padding: 4px; /* 8pxì—ì„œ ì¤„ì„ */
                font-size: 0.8em; 
                margin-bottom: 5px !important; /* í™”ë©´/í”„ë¦°íŠ¸ ë¶„ë¦¬ */
            }
            .student-review-area textarea:last-child {
                margin-bottom: 0 !important;
            }
            
            /* ê¼¬ë¦¬ë§ */
            .report-footer {
                margin-top: 10px; /* 15pxì—ì„œ ì¤„ì„ */
                padding-top: 5px;
                font-size: 8pt;
            }
            /* ë±ƒì§€ í¬ê¸° ì¡°ì • */
            .badge-item-display { width: 60px; font-size: 7pt; }
            .badge-item-display img { width: 40px; height: 40px; }
            .pie-chart { width: 90px; height: 90px; } 
        }
    </style>
</head>
<body>

    <h1>ìƒë‹´ ì¤€ë¹„ ë‹¤í–ˆë‹ˆ?</h1>

    <div id="input-area">
        <input type="text" id="api-key-input" placeholder="ì—¬ê¸°ì— ë‹¤í–ˆë‹ˆ API Key ì…ë ¥ (í•„ìˆ˜)" required>
        
        <div class="mode-selection">
            <div id="tab-single" class="mode-tab active" onclick="setMode('single')">ğŸ‘¤ ê°œë³„ í•™ìƒ ì¡°íšŒ</div>
            <div id="tab-batch" class="mode-tab" onclick="setMode('batch')">ğŸ§‘â€ğŸ¤â€ğŸ§‘ ì „ì²´ í•™ìƒ ì¼ê´„ ì¡°íšŒ</div>
        </div>

        <div id="mode-content-area">
            
            <div id="mode-single-content">
                <input type="text" id="student-code-input" placeholder="ì—¬ê¸°ì— í•™ìƒ ì½”ë“œ ì…ë ¥ (í•„ìˆ˜)" required>
            </div>
            <div id="mode-batch-content" style="display: none;">
                <div class="control-group" style="background-color: #fffde7; border-color: #ffeb3b;">
                    <h4>ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„ëœ í•™ìƒ ì½”ë“œ ì…ë ¥</h4>
                    <p style="font-size: 0.9em; color: #a1887f;">* ì „ì²´ í•™ìƒ ì½”ë“œë¥¼ ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„í•˜ì—¬ í•œ ì¤„ì— ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: A1000, A1001, A1002...)</p>
                    <textarea id="code-list-input" rows="6" placeholder="A1001, A1002, A1003, ..."></textarea>
                </div>
            </div>
            
            <div class="config-section" style="background-color: #e8f5e9; border-color: #66bb6a;">
                <h3>âœ… í•„ìˆ˜ ì…ë ¥: ìš°ë¦¬ í•™ê¸‰ì˜ ë‹¤í–ˆë‹ˆ ë‹¤í–ˆì–´ìš” í™œìš© ë°©ì•ˆ</h3>
                <p style="font-size: 0.9em; color: #777;">* ìˆ˜ì •í•´ì„œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                <textarea id="input-usage-general" rows="3" placeholder="ì˜ˆì‹œ: ìš°ë¦¬ í•™ê¸‰ì€ ë‹¤í–ˆë‹ˆ ë‹¤í–ˆì–´ìš”ë¥¼ íƒœë¸”ë¦¿ í™œìš© ìˆ˜ì—…ì˜ ë©”ì¸ í”Œë«í¼ìœ¼ë¡œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. í•™ìƒë“¤ì€ í•™ê¸‰ ìƒí™œ, ìˆ˜ì—… ì°¸ì—¬, ê³¼ì œ ìˆ˜í–‰ ë“±ì— ë”°ë¼ ì¿ í‚¤, ì´ˆì½”ì¹©, ë±ƒì§€ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤." required></textarea>
            </div>


            <div class="config-section">
                <h3>ğŸ“‹ ì„±ì¥ ê¸°ë¡ ë³´ê³ ì„œ ì¶œë ¥ í•­ëª© ì„ íƒ</h3>
                <p style="font-size: 0.9em; color: #777;">* í•­ëª©ì„ ì²´í¬í•˜ë©´ ê´€ë ¨ í™œìš© ë°©ì•ˆ ì…ë ¥ë€ì´ í™œì„±í™”ë©ë‹ˆë‹¤. í•˜ìœ„ í•­ëª©ê¹Œì§€ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                
                <div class="output-option-group" id="option-group-cookie">
                    <label>
                        <input type="checkbox" id="check-output-cookie" checked onchange="toggleConfigGroup('cookie')">
                        ğŸª ì¿ í‚¤ í™œë™ ì „ì²´ ì¶œë ¥
                    </label>
                    
                    <div id="cookie-config-details" class="sub-options">
                        <label>
                            <input type="checkbox" id="check-output-cookie-usage" checked>
                            ìš°ë¦¬ í•™ê¸‰ ì¿ í‚¤ íšë“ ë° ì‚¬ìš©
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-cookie-asset" checked>
                            ì¿ í‚¤ ìì‚° í˜„í™© (ìˆ˜ì…/ì§€ì¶œ/ì”ì—¬)
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-cookie-review" checked>
                            ë‚˜ì˜ ì¿ í‚¤ í™œë™ ëŒì•„ë³´ê¸° (í•™ìƒ ì…ë ¥ì¹¸)
                        </label>
                        
                        <p style="font-size: 0.9em; color: #777; margin-top: 10px;">* íšë“/ì‚¬ìš© ë‚´ìš©ì„ êµ¬ë¶„í•´ì„œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤. (ì˜ˆ: íšë“: ..., ì‚¬ìš©: ...)</p>
                        <textarea id="input-cookie-usage" rows="4" placeholder="íšë“: ì£¼ì œê¸€ì“°ê¸° ì œì¶œ 2ì¿ í‚¤, ë°›ì•„ì“°ê¸° 1ì¿ í‚¤~3ì¿ í‚¤, ë†€ì´ë§ˆë‹¹ 1ì¿ í‚¤~2ì¿ í‚¤, 1ì¸ 1ì—­ ì›”ê¸‰ 7ì¿ í‚¤~15ì¿ í‚¤.&#10;ì‚¬ìš©: ìë¦¬ ì„ íƒê¶Œ 20ì¿ í‚¤, ê°„ì‹êµí™˜ 5ì¿ í‚¤~10ì¿ í‚¤, ìŒì•…ì¬ìƒê¶Œ 10ì¿ í‚¤."></textarea>
                    </div>
                </div>

                <div class="output-option-group" id="option-group-chip">
                    <label>
                        <input type="checkbox" id="check-output-chip" checked onchange="toggleConfigGroup('chip')">
                        ğŸ« ì´ˆì½”ì¹© í™œë™ ì „ì²´ ì¶œë ¥
                    </label>
                    
                    <div id="chip-config-details" class="sub-options">
                        <label>
                            <input type="checkbox" id="check-output-chip-usage" checked>
                            ìš°ë¦¬ í•™ê¸‰ ì´ˆì½”ì¹© íšë“ ë° ì‚¬ìš©
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-chip-asset" checked>
                            ì´ˆì½”ì¹© ìì‚° í˜„í™© (ì”ì•¡)
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-chip-review" checked>
                            ë‚˜ì˜ ì´ˆì½”ì¹© í™œë™ ëŒì•„ë³´ê¸° (í•™ìƒ ì…ë ¥ì¹¸)
                        </label>

                        <p style="font-size: 0.9em; color: #777; margin-top: 10px;">* íšë“/ì‚¬ìš© ë‚´ìš©ì„ êµ¬ë¶„í•´ì„œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤. (ì˜ˆ: íšë“: ..., ì‚¬ìš©: ...)</p>
                        <textarea id="input-chip-usage" rows="4" placeholder="íšë“: ë°œí‘œ ë‚´ìš©ì´ ì¢‹ì€ í•™ìƒì—ê²Œ 1ì´ˆì½”ì¹©, ê²½ì²­ íƒœë„ê°€ ì¢‹ì€ í•™ìƒì—ê²Œ 1ì´ˆì½”ì¹©.&#10;ì‚¬ìš©: 10ì´ˆì½”ì¹©ì„ 1ì¿ í‚¤ë¡œ êµí™˜í•  ìˆ˜ ìˆìŒ."></textarea>
                    </div>
                </div>

                <div class="output-option-group" id="option-group-badge">
                    <label>
                        <input type="checkbox" id="check-output-badge" checked onchange="toggleConfigGroup('badge')">
                        ğŸ… ë±ƒì§€ í™œë™ ì „ì²´ ì¶œë ¥
                    </label>
                    
                    <div id="badge-config-details" class="sub-options">
                        <label>
                            <input type="checkbox" id="check-output-badge-usage" checked>
                            ìš°ë¦¬ í•™ê¸‰ ë±ƒì§€ ì†Œê°œ ë° íšë“
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-badge-status" checked>
                            í•™ìƒì˜ ë±ƒì§€ íšë“ í˜„í™©
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-badge-strength" style="display: none;">
                        </label>

                        <p style="font-size: 0.9em; color: #777; margin-top: 10px;">* ì†Œê°œ/íšë“ ë‚´ìš©ì„ êµ¬ë¶„í•´ì„œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤. (ì˜ˆ: ì†Œê°œ: ..., íšë“: ...)</p>
                        <textarea id="input-badge-usage" rows="4" placeholder="ì†Œê°œ: ì•„ì¹¨ ë…ì„œ, ë°”ë¥´ê²Œ ê¸€ì”¨ ì“°ê¸°, ì¸ì‚¬ ì˜í•˜ê¸°, í™˜ê²½ë³´í˜¸ ì‹¤ì²œí•˜ê¸°, ë§ˆìŒ ë‹¤ìŠ¤ë¦¬ê¸°, íš¨ë„ë¯¸ì…˜.&#10;íšë“: ì•„ì¹¨ í•œ ì¤„ ë…ì„œë¡ ì“°ê¸° ì™„ì„±, ë°”ë¥¸ ê¸€ì”¨ ì¹­ì°¬ 10íšŒ ì´ìƒ, ë§¤ë‹¬ í•™ê¸‰íšŒì˜ ì‹œê°„ ì¸ì‚¬ì™• ë½‘ê¸°, ì œë¡œì›¨ì´ìŠ¤íŠ¸ ë¯¸ì…˜ í†µê³¼, í˜„ëª…í•˜ê²Œ ê°ˆë“± í•´ê²°í•˜ê¸° 5íšŒ, íš¨ë„ ë¯¸ì…˜í†µê³¼."></textarea>
                    </div>
                </div>
                
                <div class="output-option-group" id="option-group-summary" style="background-color: #fce4ec; border-color: #ec407a;">
                    <label>
                        <input type="checkbox" id="check-output-summary" checked onchange="toggleConfigGroup('summary', false)">
                        ğŸ“Š ì´í‰ ì„¹ì…˜ ì „ì²´ ì¶œë ¥
                    </label>
                    <div id="summary-config-details" class="sub-options">
                        <label>
                            <input type="checkbox" id="check-output-summary-summary" checked style="display: none;"> 
                            í™œë™ ìš”ì•½ (ìë™ ì…ë ¥)
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-summary-strength" checked>
                            ì¹­ì°¬ê³¼ ë‹¤ì§ (í•™ìƒ ì…ë ¥ì¹¸)
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-summary-parent" checked>
                            ê²©ë ¤ì˜ í•œ ë§ˆë”” (í•™ë¶€ëª¨ ì…ë ¥ì¹¸)
                        </label>

                        <p style="font-size: 0.85em; color: #a1887f; margin-top: 10px;">
                            * **í™œë™ ìš”ì•½**ì€ ìë™ìœ¼ë¡œ ì…ë ¥ë˜ë©°, **ì¹­ì°¬ê³¼ ë‹¤ì§**ì€ í•™ìƒ, **ê²©ë ¤ì˜ í•œ ë§ˆë””**ëŠ” í•™ë¶€ëª¨ë‹˜ê»˜ì„œ ì‘ì„±í•˜ëŠ” í•­ëª©ì…ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>

            </div>
        </div>

        <div class="button-group">
            <button id="generate-report-btn" onclick="handleReport()">ğŸ“‹ ì„±ì¥ ê¸°ë¡í‘œ ì¶œë ¥</button>
        </div>
    </div>
    
    <div id="report-area">
        <p class="alert alert-loading">ì¶œë ¥ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì„ íƒí•œ ë°©ì‹ì— ë”°ë¼ ì„±ì¥ ê¸°ë¡ ë³´ê³ ì„œê°€ ìƒì„±ë©ë‹ˆë‹¤.</p>
    </div>

    <div class="print-download-group">
        <button onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„ / PDFë¡œ ì €ì¥</button>
        <button onclick="shareUrl()">ğŸ”— URL ê³µìœ í•˜ê¸°</button>
    </div>


    <script>
        // ==========================================================
        // 1. API ê¸°ë³¸ ì„¤ì • ë° ìƒìˆ˜
        // ==========================================================
        const BASE_URL = "https://api.dahandin.com/openapi/v1";
        
        const ALL_BADGES_LIST = [
            { title: "ì„±ì‹¤", imgUrl: "https://i.imgur.com/badge_sungsil.png" },
            { title: "ìš©ê¸°", imgUrl: "https://i.imgur.com/badge_yonggi.png" },
            { title: "ì±…ì„", imgUrl: "https://i.imgur.com/badge_chaegim.png" },
            { title: "ì¹­ì°¬ì™•", imgUrl: "https://i.imgur.com/badge_chingchan.png" },
            { title: "ë°°ë ¤", imgUrl: "https://i.imgur.com/badge_baeryeo.png" },
            { title: "ì •ì§", imgUrl: "https://i.imgur.com/badge_jungjik.png" },
            { title: "í˜‘ë™", imgUrl: "https://i.imgur.com/badge_hyeopdong.png" },
            { title: "ì°½ì˜", imgUrl: "https://i.imgur.com/badge_changui.png" },
            { title: "ë´‰ì‚¬", imgUrl: "https://i.imgur.com/badge_bongsa.png" },
        ];
        
        // 1-1, 1-2, 1-3. ì˜ˆì‹œ í…ìŠ¤íŠ¸ ìˆ˜ì •
        const USAGE_EXAMPLE_TEXTS = {
            general: "ìš°ë¦¬ í•™ê¸‰ì€ ë‹¤í–ˆë‹ˆ ë‹¤í–ˆì–´ìš”ë¥¼ íƒœë¸”ë¦¿ í™œìš© ìˆ˜ì—…ì˜ ë©”ì¸ í”Œë«í¼ìœ¼ë¡œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. í•™ìƒë“¤ì€ í•™ê¸‰ ìƒí™œ, ìˆ˜ì—… ì°¸ì—¬, ê³¼ì œ ìˆ˜í–‰ ë“±ì— ë”°ë¼ ì¿ í‚¤, ì´ˆì½”ì¹©, ë±ƒì§€ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤.",
            // 1-1. ì¿ í‚¤ í…ìŠ¤íŠ¸ ìˆ˜ì •
            cookieUsage: "íšë“: ì£¼ì œê¸€ì“°ê¸° ì œì¶œ 2ì¿ í‚¤, ë°›ì•„ì“°ê¸° 1ì¿ í‚¤~3ì¿ í‚¤, ë†€ì´ë§ˆë‹¹ 1ì¿ í‚¤~2ì¿ í‚¤, 1ì¸ 1ì—­ ì›”ê¸‰ 7ì¿ í‚¤~15ì¿ í‚¤ \nì‚¬ìš©: ìë¦¬ ì„ íƒê¶Œ 20ì¿ í‚¤, ê°„ì‹êµí™˜ 5ì¿ í‚¤~10ì¿ í‚¤, ìŒì•…ì¬ìƒê¶Œ 10ì¿ í‚¤",
            // 1-2. ì´ˆì½”ì¹© í…ìŠ¤íŠ¸ ìˆ˜ì •
            chipUsage: "íšë“: ë°œí‘œ ë‚´ìš©ì´ ì¢‹ì€ í•™ìƒì—ê²Œ 1ì´ˆì½”ì¹©, ê²½ì²­ íƒœë„ê°€ ì¢‹ì€ í•™ìƒì—ê²Œ 1ì´ˆì½”ì¹©. \nì‚¬ìš©: 10ì´ˆì½”ì¹©ì„ 1ì¿ í‚¤ë¡œ êµí™˜í•  ìˆ˜ ìˆìŒ.",
            // 1-3. ë±ƒì§€ í…ìŠ¤íŠ¸ ìˆ˜ì •
            badgeUsage: "ì†Œê°œ: ì•„ì¹¨ ë…ì„œ, ë°”ë¥´ê²Œ ê¸€ì”¨ ì“°ê¸°, ì¸ì‚¬ ì˜í•˜ê¸°, í™˜ê²½ë³´í˜¸ ì‹¤ì²œí•˜ê¸°, ë§ˆìŒ ë‹¤ìŠ¤ë¦¬ê¸°, íš¨ë„ë¯¸ì…˜ \níšë“: ì•„ì¹¨ í•œ ì¤„ ë…ì„œë¡ ì“°ê¸° ì™„ì„±, ë°”ë¥¸ ê¸€ì”¨ ì¹­ì°¬ 10íšŒ ì´ìƒ, ë§¤ë‹¬ í•™ê¸‰íšŒì˜ ì‹œê°„ ì¸ì‚¬ì™• ë½‘ê¸°, ì œë¡œì›¨ì´ìŠ¤íŠ¸ ë¯¸ì…˜ í†µê³¼, í˜„ëª…í•˜ê²Œ ê°ˆë“± í•´ê²°í•˜ê¸° 5íšŒ, íš¨ë„ ë¯¸ì…˜í†µê³¼"
        };

        let currentMode = 'single'; 

        // ==========================================================
        // 2. ì…ë ¥ ì„ íƒ ë° ì´ˆê¸° ë¡œë”© í•¨ìˆ˜
        // ==========================================================
        
        function setMode(mode) {
            currentMode = mode;
            document.getElementById('tab-single').classList.remove('active');
            document.getElementById('tab-batch').classList.remove('active');
            document.getElementById('mode-single-content').style.display = 'none';
            document.getElementById('mode-batch-content').style.display = 'none';
            
            if (mode === 'single') {
                document.getElementById('tab-single').classList.add('active');
                document.getElementById('mode-single-content').style.display = 'block';
            } else {
                document.getElementById('tab-batch').classList.add('active');
                document.getElementById('mode-batch-content').style.display = 'block';
            }
            document.getElementById('generate-report-btn').innerText = (mode === 'single') 
                ? 'ğŸ“‹ ì„±ì¥ ê¸°ë¡í‘œ ì¶œë ¥' 
                : 'ğŸ“‚ ì¼ê´„ ì„±ì¥ ê¸°ë¡í‘œ ì¶œë ¥';
            document.getElementById('report-area').innerHTML = '<p class="alert alert-loading">ì¶œë ¥ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì„ íƒí•œ ë°©ì‹ì— ë”°ë¼ ì„±ì¥ ê¸°ë¡ ë³´ê³ ì„œê°€ ìƒì„±ë©ë‹ˆë‹¤.</p>';
        }
        
        function toggleConfigGroup(groupName, isAssetGroup = true) {
            const masterCheck = document.getElementById(`check-output-${groupName}`);
            const detailContainer = document.getElementById(`${groupName}-config-details`);
            
            if (masterCheck.checked) {
                detailContainer.style.display = 'block';
            } else {
                detailContainer.style.display = 'none';
            }

            if (isAssetGroup) {
                detailContainer.querySelectorAll('input[type="checkbox"]').forEach(subCheck => {
                    subCheck.checked = masterCheck.checked;
                });
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            setMode('single'); 
            
            // 1-1, 1-2, 1-3. ì˜ˆì‹œ í…ìŠ¤íŠ¸ ì´ˆê¸°ê°’ ì„¤ì •
            document.getElementById('input-usage-general').value = USAGE_EXAMPLE_TEXTS.general;
            document.getElementById('input-cookie-usage').value = USAGE_EXAMPLE_TEXTS.cookieUsage;
            document.getElementById('input-chip-usage').value = USAGE_EXAMPLE_TEXTS.chipUsage;
            document.getElementById('input-badge-usage').value = USAGE_EXAMPLE_TEXTS.badgeUsage;

            toggleConfigGroup('cookie');
            toggleConfigGroup('chip');
            toggleConfigGroup('badge');
            document.getElementById('check-output-badge-strength').checked = false; 
            toggleConfigGroup('summary', false);
        });

        // ==========================================================
        // 3. ë°ì´í„° ë¡œì§ í•¨ìˆ˜ 
        // ==========================================================

        function getReportConfig() {
            const cookieUsageElement = document.getElementById('input-cookie-usage');
            const chipUsageElement = document.getElementById('input-chip-usage');
            const badgeUsageElement = document.getElementById('input-badge-usage');
            
            const config = {
                generalUsage: document.getElementById('input-usage-general').value.trim(),

                cookie: document.getElementById('check-output-cookie').checked ? {
                    // Checkbox is for outputting the section, value is from the textarea
                    usage: document.getElementById('check-output-cookie-usage').checked ? (cookieUsageElement ? cookieUsageElement.value.trim() : USAGE_EXAMPLE_TEXTS.cookieUsage) : null,
                    asset: document.getElementById('check-output-cookie-asset').checked,
                    review: document.getElementById('check-output-cookie-review').checked,
                } : null,
                
                chip: document.getElementById('check-output-chip').checked ? {
                    usage: document.getElementById('check-output-chip-usage').checked ? (chipUsageElement ? chipUsageElement.value.trim() : USAGE_EXAMPLE_TEXTS.chipUsage) : null,
                    asset: document.getElementById('check-output-chip-asset').checked,
                    review: document.getElementById('check-output-chip-review').checked,
                } : null,

                badge: document.getElementById('check-output-badge').checked ? {
                    usage: document.getElementById('check-output-badge-usage').checked ? (badgeUsageElement ? badgeUsageElement.value.trim() : USAGE_EXAMPLE_TEXTS.badgeUsage) : null,
                    status: document.getElementById('check-output-badge-status').checked,
                    strength: false, 
                } : null,
                
                summary: document.getElementById('check-output-summary').checked ? {
                    output: document.getElementById('check-output-summary').checked,
                    summary: true, 
                    praiseAndResolve: document.getElementById('check-output-summary-strength').checked, 
                    parentComment: document.getElementById('check-output-summary-parent').checked,
                } : null,
            };
            
            if (!document.getElementById('check-output-cookie').checked) config.cookie = null;
            if (!document.getElementById('check-output-chip').checked) config.chip = null;
            if (!document.getElementById('check-output-badge').checked) config.badge = null;
            if (!document.getElementById('check-output-summary').checked) config.summary = null;

            return config;
        }

        const CUMULATIVE_BADGES = {}; 
        
        function archiveAndRetrieveCumulativeBadges(studentCode, liveBadges) {
            if (!CUMULATIVE_BADGES[studentCode]) { CUMULATIVE_BADGES[studentCode] = {}; }
            if (liveBadges && typeof liveBadges === 'object') {
                Object.values(liveBadges).forEach(badge => {
                    if (badge && badge.hasBadge) {
                        CUMULATIVE_BADGES[studentCode][badge.title] = {
                            title: badge.title,
                            imgUrl: badge.imgUrl || ALL_BADGES_LIST.find(b => b.title === badge.title)?.imgUrl || 'placeholder_badge.png', 
                            hasBadge: true
                        };
                    }
                });
            }
            return Object.values(CUMULATIVE_BADGES[studentCode]);
        }
        
        function generatePraiseSummary(studentName, report) {
            const { totalCookieIncome, currentChocoChips, allAcquiredBadges } = report;
            const earnedTitles = allAcquiredBadges.map(b => b.title);
            const badgeTitlesString = earnedTitles.length > 0 ? `(${earnedTitles.join(', ')})` : '(íšë“í•œ ë±ƒì§€ ì—†ìŒ)';

            const autoSummaryText = `${studentName} í•™ìƒì€ ìš°ë¦¬ í•™ê¸‰ ë‹¤í–ˆë‹ˆ ë‹¤í–ˆì–´ìš” í™œë™ì„ í†µí•´
*ì¿ í‚¤(${totalCookieIncome}ê°œ), *ì´ˆì½”ì¹©(${currentChocoChips}ê°œ), *ë±ƒì§€${badgeTitlesString}ë¥¼ íšë“í•˜ì˜€ìŠµë‹ˆë‹¤.`;
            
            const praiseAndResolveText = `[êµì‚¬ ì°¸ê³ ] ì´ ìë¦¬ì— ì„ ìƒë‹˜ì´ ëŒ€ì‹  ì¹­ì°¬ê³¼ ê²©ë ¤ì˜ ë©”ì‹œì§€ë¥¼ ì ê±°ë‚˜, í•™ìƒì´ ì§ì ‘ ì˜í•œ ì ê³¼ ë‹¤ì§ì„ ì ì„ ìˆ˜ ìˆë„ë¡ ì•ˆë‚´í•´ì£¼ì„¸ìš”.`;
            
            return { 
                autoSummary: autoSummaryText, 
                praiseAndResolve: praiseAndResolveText,
            };
        }
        
        async function getStudentDataWithKey(studentCode, apiKey) {
             const endpoint = `${BASE_URL}/get/student/total?code=${studentCode}`;
             try {
                 if (!apiKey || !studentCode) { return { error: "API Keyì™€ í•™ìƒ ì½”ë“œê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤." }; }
                 const response = await fetch(endpoint, { method: "GET", headers: { "X-API-Key": apiKey } });
                 if (!response.ok) {
                     const errorText = await response.text();
                     return { error: `API í˜¸ì¶œ ì‹¤íŒ¨ (ìƒíƒœ ì½”ë“œ: ${response.status})` };
                 }
                 const json = await response.json();
                 if (json.result === true) { return json.data; } else { return { error: json.message || "ì•Œ ìˆ˜ ì—†ëŠ” API ì‘ë‹µ ì˜¤ë¥˜" }; }
             } catch (error) { 
                 return { error: "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ì„œë²„ ì ‘ì† ì‹¤íŒ¨" }; 
             }
        }
        
        async function generateCumulativeReport(studentCode, apiKey, config) {
            const liveData = await getStudentDataWithKey(studentCode, apiKey);
            if (liveData.error) return { error: liveData.error };
            
            const totalCookieIncome = liveData.cookie || 0;
            const totalCookieUsed = liveData.usedCookie || 0;
            const currentChocoChips = liveData.chocoChips || 0;
            
            const allAcquiredBadges = archiveAndRetrieveCumulativeBadges(studentCode, liveData.badges);

            let usageRatio = 0;
            let savingRatio = 0;
            if (totalCookieIncome > 0) {
                usageRatio = (totalCookieUsed / totalCookieIncome) * 100;
                savingRatio = (100 - usageRatio);
            }
            
            const report = {
                student: liveData.name || "í•™ìƒ", 
                reportDate: new Date().toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' }),
                config: config, 
                allAcquiredBadges: allAcquiredBadges, 
                studentCode: studentCode, 
                
                totalCookieIncome: totalCookieIncome,
                totalCookieUsed: totalCookieUsed,
                currentChocoChips: currentChocoChips,
                cookieSavingRatio: savingRatio.toFixed(1),
                cookieUsageRatio: usageRatio.toFixed(1),
            };
            
            report.analysis = generatePraiseSummary(report.student, report);
            
            return report;
        }

        // ==========================================================
        // 4. ì¶œë ¥ í—¬í¼ í•¨ìˆ˜
        // ==========================================================
        
        function shareUrl() {
            const url = window.location.href;
            if (navigator.clipboard) {
                navigator.clipboard.writeText(url).then(() => {
                    alert("í˜„ì¬ ë³´ê³ ì„œì˜ URLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! (ì£¼ì˜: ë¡œì»¬ íŒŒì¼ ì‹¤í–‰ ì‹œ URL ê³µìœ ê°€ ë¶ˆê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤)");
                }).catch(err => {
                    alert(`URL ë³µì‚¬ ì‹¤íŒ¨. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”: ${url}`);
                });
            } else {
                alert(`í´ë¦½ë³´ë“œ APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” í™˜ê²½ì…ë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”: ${url}`);
            }
        }

        async function handleReport() {
            const apiKey = document.getElementById('api-key-input').value.trim();
            const reportArea = document.getElementById('report-area');
            const config = getReportConfig(); 
            
            if (!apiKey) { reportArea.innerHTML = '<p class="alert alert-error">API Keyë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>'; return; }
            if (!config.generalUsage) { reportArea.innerHTML = '<p class="alert alert-error">í•„ìˆ˜ ì…ë ¥ í•­ëª©ì¸ "í™œìš© ë°©ì•ˆ"ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>'; return; }
            
            let studentCodes = [];
            if (currentMode === 'single') {
                const studentCode = document.getElementById('student-code-input').value.trim();
                if (!studentCode) { reportArea.innerHTML = '<p class="alert alert-error">í•™ìƒ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>'; return; }
                studentCodes.push(studentCode);
            } else if (currentMode === 'batch') {
                const codeListText = document.getElementById('code-list-input').value.trim();
                if (!codeListText) { reportArea.innerHTML = '<p class="alert alert-error">í•™ìƒ ì½”ë“œ ëª©ë¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>'; return; }
                studentCodes = codeListText.split(',').map(code => code.trim()).filter(code => code.length > 0);
            }
            
            document.getElementById('generate-report-btn').disabled = true;
            reportArea.innerHTML = '<p class="alert alert-loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>';
            let allReportsHtml = '';
            
            for (const code of studentCodes) {
                const reportData = await generateCumulativeReport(code, apiKey, config);
                if (reportData.error) {
                    allReportsHtml += `<div class="report-error-block"><h2>âš ï¸ ì˜¤ë¥˜: í•™ìƒ ì½”ë“œ ${code}</h2><p>${reportData.error}</p></div>`;
                } else {
                    allReportsHtml += generateReportHtml(reportData, studentCodes.length > 1);
                }
            }
            
            reportArea.innerHTML = allReportsHtml;
            document.getElementById('generate-report-btn').disabled = false;
        }

        function generatePieChartStyle(saving, usage) {
            const saveColor = '#2ecc71';
            const useColor = '#e74c3c';
            return `background: conic-gradient(${saveColor} 0% ${saving}%, ${useColor} ${saving}% 100%);`;
        }
        
        /**
         * ì…ë ¥ í…ìŠ¤íŠ¸ë¥¼ íŠ¹ì • í‚¤ì›Œë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ íšë“/ì‚¬ìš©(ë˜ëŠ” ì†Œê°œ/íšë“)ìœ¼ë¡œ ë¶„ë¦¬í•©ë‹ˆë‹¤.
         */
        function splitUsageText(inputText, primaryKeyword, secondaryKeyword) {
            const input = inputText || '';
            let primaryContent = 'ë‚´ìš© ì—†ìŒ';
            let secondaryContent = 'ë‚´ìš© ì—†ìŒ';

            const primaryRegex = new RegExp(`${primaryKeyword}:(.*?)(?:\\n${secondaryKeyword}:|$)`, 's');
            const secondaryRegex = new RegExp(`${secondaryKeyword}:(.*)`, 's');

            const matchPrimary = input.match(primaryRegex);
            const matchSecondary = input.match(secondaryRegex);

            if (matchPrimary && matchPrimary[1]) {
                primaryContent = matchPrimary[1].trim();
            } else if (input.trim().startsWith(`${primaryKeyword}:`)) {
                primaryContent = input.replace(`${primaryKeyword}:`, '').trim();
            }
            
            if (matchSecondary && matchSecondary[1]) {
                secondaryContent = matchSecondary[1].trim();
            }

            return { primary: primaryContent, secondary: secondaryContent };
        }

        // 3. ì¶œë ¥ í™”ë©´ HTML ìƒì„± í•¨ìˆ˜ ìˆ˜ì •
        function generateReportHtml(report, isBatchMode) {
            const { student, reportDate, config, allAcquiredBadges, totalCookieIncome, totalCookieUsed, currentChocoChips, cookieSavingRatio, cookieUsageRatio } = report;
            const { cookie, chip, badge, summary } = config;
            
            let html = `
                <div class="report-page" style="page-break-after: ${isBatchMode ? 'always' : 'auto'};">
                    <h1>âœ¨ ${student} í•™ìƒì˜ ì„±ì¥ ê¸°ë¡ âœ¨</h1>
                    
                    <div class="usage-section">
                        <h2>ğŸ“Œ ìš°ë¦¬ í•™ê¸‰ì˜ ë‹¤í–ˆë‹ˆ ë‹¤í–ˆì–´ìš” í™œìš© ë°©ì•ˆ</h2>
                        <div class="usage-text">${config.generalUsage}</div>
                    </div>
            `;

            // ==========================================================
            // ì¿ í‚¤ í™œë™ ì„¹ì…˜ (Cookie)
            // ==========================================================
            if (cookie) {
                html += `
                    <div class="asset-section-container">
                        <h2 class="activity-title">ğŸª ${student} í•™ìƒì˜ ì¿ í‚¤ í™œë™</h2>
                `;
                
                html += '<div class="dynamic-column-layout">';
                
                if (cookie.usage) {
                    const { primary: acquisition, secondary: use } = splitUsageText(cookie.usage, 'íšë“', 'ì‚¬ìš©');
                    
                    html += `
                        <div style="flex: 1 1 30%;">
                            <div class="column-title">ğŸª ìš°ë¦¬ í•™ê¸‰ ì¿ í‚¤ íšë“ ë° ì‚¬ìš©</div>
                            
                            <div class="usage-content-block" style="border-bottom: 1px dashed #ccc; padding-bottom: 10px; margin-bottom: 10px; line-height: 1.4;">
                                <p style="font-weight: bold; color: #2ecc71; margin-bottom: 5px; font-size: 1em;">íšë“</p>
                                <p style="white-space: pre-wrap; font-size: 0.9em;">${acquisition}</p>
                            </div>
                            
                            <div class="usage-content-block" style="border-bottom: none; margin-bottom: 0; padding-bottom: 0; line-height: 1.4;">
                                <p style="font-weight: bold; color: #e74c3c; margin-bottom: 5px; font-size: 1em;">ì‚¬ìš©</p>
                                <p style="white-space: pre-wrap; font-size: 0.9em;">${use}</p>
                            </div>
                        </div>
                    `;
                }

                // ì¿ í‚¤ ìì‚° í˜„í™© (ì› ê·¸ë˜í”„ ë³µêµ¬)
                if (cookie.asset) {
                    html += `
                        <div style="flex: 1 1 30%;">
                            <div class="column-title">ğŸ’° ì¿ í‚¤ ìì‚° í˜„í™©</div>
                            <div class="center-asset-content">
                                <div class="graph-container">
                                    <div class="pie-chart" style="${generatePieChartStyle(cookieSavingRatio, cookieUsageRatio)}">
                                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.1em; font-weight: bold; color: #333;">
                                            ${cookieSavingRatio}%
                                            <div style="font-size: 0.7em; font-weight: normal; color: #777;">(ì €ì¶•)</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="cookie-asset-info">
                                    <div class="cookie-asset-item"><span>ì´ íšë“ (ìˆ˜ì…)</span> <span>${totalCookieIncome}ê°œ</span></div>
                                    <div class="cookie-asset-item"><span>ì´ ì‚¬ìš© (ì§€ì¶œ)</span> <span>${totalCookieUsed}ê°œ</span></div>
                                    <div class="cookie-asset-item"><span>ë‚¨ì€ ì¿ í‚¤ (ì”ì—¬)</span> <span>${totalCookieIncome - totalCookieUsed}ê°œ</span></div>
                                </div>
                            </div>
                        </div>
                    `;
                }

                // ë‚˜ì˜ ì¿ í‚¤ í™œë™ ëŒì•„ë³´ê¸° (í•™ìƒ ì…ë ¥ì¹¸)
                if (cookie.review) {
                    html += `
                        <div style="flex: 1 1 40%;">
                            <div class="column-title">ğŸª ë‚˜ì˜ ì¿ í‚¤ í™œë™ ëŒì•„ë³´ê¸°</div>
                            <div class="student-review-area">
                                <label>1. ì¿ í‚¤ íšë“ ë¹„ë²•:</label>
                                <textarea placeholder=""></textarea>
                                <label>2. ì¢‹ì•˜ë˜ ì :</label>
                                <textarea placeholder=""></textarea>
                            </div>
                        </div>
                    `;
                }
                
                html += '</div></div>';
            }

            // ==========================================================
            // ì´ˆì½”ì¹© í™œë™ ì„¹ì…˜ (Chip)
            // ==========================================================
            if (chip) {
                html += `
                    <div class="asset-section-container">
                        <h2 class="activity-title">ğŸ« ${student} í•™ìƒì˜ ì´ˆì½”ì¹© í™œë™</h2>
                `;
                
                html += '<div class="dynamic-column-layout">';
                
                // 1. ìš°ë¦¬ í•™ê¸‰ ì´ˆì½”ì¹© íšë“ ë° ì‚¬ìš© í•­ëª© ì–‘ë¶„ êµ¬ì„±
                if (chip.usage) {
                    const { primary: acquisition, secondary: use } = splitUsageText(chip.usage, 'íšë“', 'ì‚¬ìš©');
                    html += `
                        <div style="flex: 1 1 30%;">
                            <div class="column-title">ğŸ« ìš°ë¦¬ í•™ê¸‰ ì´ˆì½”ì¹© íšë“ ë° ì‚¬ìš©</div>
                            
                            <div class="usage-content-block" style="border-bottom: 1px dashed #ccc; padding-bottom: 10px; margin-bottom: 10px; line-height: 1.4;">
                                <p style="font-weight: bold; color: #2ecc71; margin-bottom: 5px; font-size: 1em;">íšë“</p>
                                <p style="white-space: pre-wrap; font-size: 0.9em;">${acquisition}</p>
                            </div>
                            
                            <div class="usage-content-block" style="border-bottom: none; margin-bottom: 0; padding-bottom: 0; line-height: 1.4;">
                                <p style="font-weight: bold; color: #e74c3c; margin-bottom: 5px; font-size: 1em;">ì‚¬ìš©</p>
                                <p style="white-space: pre-wrap; font-size: 0.9em;">${use}</p>
                            </div>
                        </div>
                    `;
                }

                // ì´ˆì½”ì¹© ìì‚° í˜„í™©
                if (chip.asset) {
                    html += `
                        <div style="flex: 1 1 30%;">
                            <div class="column-title">ğŸ« ì´ˆì½”ì¹© ìì‚° í˜„í™© (ì”ì•¡)</div>
                            <div class="center-asset-content">
                                <h3 style="color: #d35400; font-size: 2.5em; margin: 20px 0;">${currentChocoChips}ê°œ</h3>
                            </div>
                        </div>
                    `;
                }

                // ë‚˜ì˜ ì´ˆì½”ì¹© í™œë™ ëŒì•„ë³´ê¸° (í•™ìƒ ì…ë ¥ì¹¸)
                if (chip.review) {
                    html += `
                        <div style="flex: 1 1 40%;">
                            <div class="column-title">ğŸ« ë‚˜ì˜ ì´ˆì½”ì¹© í™œë™ ëŒì•„ë³´ê¸°</div>
                            <div class="student-review-area">
                                <label>1. ì´ˆì½”ì¹© íšë“ ë¹„ë²•:</label>
                                <textarea placeholder=""></textarea>
                                <label>2. ì¢‹ì•˜ë˜ ì :</label>
                                <textarea placeholder=""></textarea>
                            </div>
                        </div>
                    `;
                }
                
                html += '</div></div>';
            }

            // ==========================================================
            // ë±ƒì§€ í™œë™ ì„¹ì…˜ (Badge)
            // ==========================================================
            if (badge) {
                html += `
                    <div class="asset-section-container">
                        <h2 class="activity-title">ğŸ… ${student} í•™ìƒì˜ ë±ƒì§€ í™œë™</h2>
                `;
                
                html += '<div class="dynamic-column-layout">';
                
                // 1. ë±ƒì§€ ì†Œê°œ ë° íšë“ ì–‘ë¶„ êµ¬ì„±
                if (badge.usage) {
                    const { primary: introduction, secondary: acquisition } = splitUsageText(badge.usage, 'ì†Œê°œ', 'íšë“');
                    html += `
                        <div style="flex: 1 1 30%;">
                            <div class="column-title">ğŸ… ìš°ë¦¬ í•™ê¸‰ ë±ƒì§€ ì†Œê°œ ë° íšë“</div>
                            
                            <div class="usage-content-block" style="border-bottom: 1px dashed #ccc; padding-bottom: 10px; margin-bottom: 10px; line-height: 1.4;">
                                <p style="font-weight: bold; color: #1e88e5; margin-bottom: 5px; font-size: 1em;">ì†Œê°œ</p>
                                <p style="white-space: pre-wrap; font-size: 0.9em;">${introduction}</p>
                            </div>
                            
                            <div class="usage-content-block" style="border-bottom: none; margin-bottom: 0; padding-bottom: 0; line-height: 1.4;">
                                <p style="font-weight: bold; color: #2ecc71; margin-bottom: 5px; font-size: 1em;">íšë“</p>
                                <p style="white-space: pre-wrap; font-size: 0.9em;">${acquisition}</p>
                            </div>
                        </div>
                    `;
                }

                // ë±ƒì§€ íšë“ í˜„í™© (í¬íŠ¸í´ë¦¬ì˜¤ ë³µêµ¬)
                if (badge.status) {
                    html += `
                        <div style="flex: 1 1 30%;">
                            <div class="column-title">ğŸ… í•™ìƒì˜ ë±ƒì§€ íšë“ í˜„í™©</div>
                            <div class="all-badges-container">
                    `;
                    
                    if (allAcquiredBadges.length > 0) {
                        allAcquiredBadges.forEach(b => {
                            html += `
                                <div class="badge-item-display acquired">
                                    <img src="${b.imgUrl}" alt="${b.title} ë±ƒì§€">
                                    <span>${b.title}</span>
                                </div>
                            `;
                        });
                    } else {
                         html += `
                            <p style="text-align: center; font-size: 0.9em; color: #777; width: 100%; margin: 10px 0;">ì•„ì§ íšë“í•œ ë±ƒì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        `;
                    }

                    html += `
                            </div>
                        </div>
                    `;
                }

                // ë‚˜ì˜ ë±ƒì§€ í™œë™ ëŒì•„ë³´ê¸° 
                if (badge.status) {
                    html += `
                        <div style="flex: 1 1 40%;">
                            <div class="column-title">ğŸ… ë‚˜ì˜ ë±ƒì§€ í™œë™ ëŒì•„ë³´ê¸°</div>
                            <div class="student-review-area">
                                <label>1. ê°€ì¥ ìë‘ìŠ¤ëŸ¬ìš´ ë±ƒì§€ì™€ ê·¸ ì´ìœ :</label>
                                <textarea placeholder=""></textarea>
                                <label>2. ë‚´ê°€ ë°›ê³  ì‹¶ì€ ë±ƒì§€ ì¶”ì²œ:</label>
                                <textarea placeholder=""></textarea>
                            </div>
                        </div>
                    `;
                }
                
                html += '</div>'; // dynamic-column-layout ì¢…ë£Œ
                
                html += '</div>';
            }
            
            // ==========================================================
            // ì´í‰ ì„¹ì…˜ (Summary)
            // ==========================================================
            if (summary) {
                html += `<div class="summary-section">
                    <h2>ğŸ“Š ì´í‰</h2>`;

                // í™œë™ ìš”ì•½
                if (summary.summary) {
                    html += `
                        <h3>1. í™œë™ ìš”ì•½</h3>
                        <div class="auto-summary-area">${report.analysis.autoSummary}</div>
                    `;
                }
                
                // ì¹­ì°¬ê³¼ ë‹¤ì§
                if (summary.praiseAndResolve) {
                    html += `
                        <h3>2. ì¹­ì°¬ê³¼ ë‹¤ì§</h3>
                        <textarea class="summary-textarea" rows="4" placeholder="í•™ìƒ ì…ë ¥: ìŠ¤ìŠ¤ë¡œ ì˜í•œ ë¶€ë¶„ì„ ì¹­ì°¬í•˜ê³  ì•ìœ¼ë¡œì˜ ë‹¤ì§ì„ ì ì–´ë´…ì‹œë‹¤."></textarea>
                    `;
                }
                
                // ê²©ë ¤ì˜ í•œ ë§ˆë””
                if (summary.parentComment) {
                    html += `
                        <h3>3. ê²©ë ¤ì˜ í•œ ë§ˆë””</h3>
                        <textarea class="summary-textarea" rows="4" placeholder="í•™ë¶€ëª¨ ì…ë ¥ : ìë…€ë¥¼ ìœ„í•œ ê²©ë ¤ì˜ í•œ ë§ˆë””ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”."></textarea>
                    `;
                }
                
                html += `</div>`;
            }

            // ì¡°íšŒ ì¼ì‹œë¥¼ ê¼¬ë¦¬ë§ ë¶€ë¶„ì— ìƒì„±
            html += `
                <div class="report-footer">
                    ì¡°íšŒ ì¼ì‹œ: ${reportDate}
                </div>
            `;


            html += `</div>`;
            return html;
        }

    </script>
</body>
</html>