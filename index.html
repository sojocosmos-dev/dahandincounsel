<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìƒë‹´ ì¤€ë¹„ ë‹¤í–ˆë‹ˆ? ì„±ì¥ ê¸°ë¡</title>
    <style>
        /* ===== ìƒ‰ìƒ ë³€ìˆ˜ ===== */
        :root {
            --color-primary: #2ecc71;
            --color-primary-dark: #27ae60;
            --color-secondary: #3498db;
            --color-secondary-dark: #2980b9;
            --color-bg-light: #f8f8f8;
            --color-bg-white: #ffffff;
            --color-border: #ddd;
            --color-border-light: #e0e0e0;
            --color-text-dark: #333;
            --color-text-muted: #777;
            --color-danger: #e74c3c;
            --color-warning: #ffc107;
            --color-info: #1e88e5;
            --color-success: #2ecc71;
        }

        /* ===== ê¸°ë³¸ ìŠ¤íƒ€ì¼ ===== */
        body {
            font-family: 'Malgun Gothic', 'Arial', sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 0 20px;
            background-color: var(--color-bg-light);
        }

        input[type="text"],
        textarea,
        input[type="file"] {
            padding: 10px;
            margin: 8px 0;
            width: 100%;
            box-sizing: border-box;
            font-size: 16px;
            border-radius: 4px;
            border: 1px solid var(--color-border);
            resize: vertical;
        }

        /* ===== ë²„íŠ¼ ìŠ¤íƒ€ì¼ ===== */
        .button-group button,
        .print-download-group button {
            padding: 12px 20px;
            margin: 5px;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 6px;
            transition: background-color 0.3s ease;
            font-weight: 600;
        }

        .button-group button {
            background-color: var(--color-primary);
        }

        .button-group button:hover {
            background-color: var(--color-primary-dark);
        }

        .print-download-group button {
            background-color: var(--color-secondary);
            padding: 10px 18px;
            font-size: 1em;
        }

        .print-download-group button:hover {
            background-color: var(--color-secondary-dark);
        }

        .button-group,
        .print-download-group {
            text-align: center;
            margin-bottom: 20px;
            margin-top: 20px;
        }

        /* ===== ì…ë ¥ ì˜ì—­ ìŠ¤íƒ€ì¼ ===== */
        #input-area {
            background-color: var(--color-bg-white);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .config-section {
            margin-top: 15px;
            padding: 10px;
            border: 1px solid var(--color-border-light);
            border-radius: 6px;
            background-color: #fefefe;
        }

        .output-option-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 10px;
            padding: 8px;
            border: 1px solid #b3e5fc;
            border-radius: 4px;
            background-color: #e1f5fe;
        }

        /* ===== íƒ­ ìŠ¤íƒ€ì¼ ===== */
        .mode-selection {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 2px solid var(--color-border);
        }

        .mode-tab {
            flex: 1;
            padding: 10px 0;
            text-align: center;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            font-weight: bold;
            color: var(--color-text-muted);
            transition: all 0.3s ease;
        }

        .mode-tab.active {
            border-bottom: 2px solid var(--color-primary);
            color: var(--color-primary);
            background-color: #e8f5e9;
        }

        /* ===== ë³´ê³ ì„œ ìŠ¤íƒ€ì¼ ===== */
        #report-area {
            background-color: var(--color-bg-white);
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }

        h1 {
            color: #4a4a4a;
            text-align: center;
            font-size: 2.5em;
            border-bottom: 3px solid #ff9800;
            padding-bottom: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            white-space: nowrap;
        }

        /* ===== ì„¹ì…˜ ìŠ¤íƒ€ì¼ ===== */
        .usage-section {
            background-color: #fff8e1;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 5px solid var(--color-warning);
        }

        .summary-section {
            background-color: #e0f7fa;
            border: 2px solid #00bcd4;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .summary-section h2 {
            color: #00838f;
            font-size: 1.5em;
            margin-top: 0;
            margin-bottom: 10px;
        }

        .summary-section h3 {
            color: #00bcd4;
            font-size: 1.2em;
            margin-top: 10px;
            margin-bottom: 8px;
        }

        .summary-textarea {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
            font-size: 1em;
            box-sizing: border-box;
        }

        /* ===== ìì‚° ì„¹ì…˜ ìŠ¤íƒ€ì¼ ===== */
        .asset-section-container {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #f0f0f0;
            border-radius: 8px;
        }

        .activity-title {
            font-size: 1.4em;
            font-weight: bold;
            color: var(--color-info);
            margin-top: 25px;
            margin-bottom: 15px;
            border-bottom: 2px solid #bbdefb;
            padding-bottom: 5px;
        }

        /* ===== ë‹¤ì¤‘ ì¹¼ëŸ¼ ë ˆì´ì•„ì›ƒ ===== */
        .dynamic-column-layout {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .dynamic-column-layout > div {
            display: flex;
            flex-direction: column;
            padding: 8px;
            border: 1px dashed var(--color-border-light);
            border-radius: 4px;
            min-height: 220px;
            box-sizing: border-box;
        }

        .column-title {
            font-weight: bold;
            color: var(--color-text-dark);
            margin-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 5px;
        }

        /* ===== ì¿ í‚¤ ìì‚° ìŠ¤íƒ€ì¼ ===== */
        .center-asset-content {
            text-align: center;
        }

        .cookie-asset-info {
            margin-top: 10px;
            font-size: 0.9em;
            text-align: left;
            padding: 0 15px;
        }

        .cookie-asset-info strong {
            display: block;
            margin-bottom: 5px;
            font-size: 1em;
        }

        .cookie-asset-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            padding: 3px 0;
            border-bottom: 1px dotted #eee;
        }

        /* ===== í•™ìƒ ëŒì•„ë³´ê¸° ìŠ¤íƒ€ì¼ ===== */
        .student-review-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .student-review-area textarea {
            flex-grow: 1;
            min-height: 0;
            font-size: 0.95em;
            padding: 8px;
            margin: 0 0 10px 0;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .student-review-area textarea:last-child {
            margin-bottom: 0;
        }

        /* ===== ê·¸ë˜í”„ ìŠ¤íƒ€ì¼ ===== */
        .graph-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
        }

        .pie-chart {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        /* ===== ë±ƒì§€ í¬íŠ¸í´ë¦¬ì˜¤ ìŠ¤íƒ€ì¼ ===== */
        .all-badges-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 10px 0;
            justify-content: center;
        }

        .badge-item-display {
            width: 80px;
            text-align: center;
            font-size: 0.85em;
            line-height: 1.2;
        }

        .badge-item-display span {
            display: block;
            white-space: normal;
            overflow-wrap: break-word;
            word-wrap: break-word;
        }

        .badge-item-display img {
            width: 50px;
            height: 50px;
            margin-bottom: 3px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--color-primary);
            box-shadow: 0 0 5px rgba(46, 204, 113, 0.5);
        }

        /* ===== í•˜ë‹¨ ìŠ¤íƒ€ì¼ ===== */
        .report-footer {
            text-align: right;
            margin-top: 30px;
            padding-top: 8px;
            border-top: 1px solid var(--color-border);
            color: var(--color-text-muted);
            font-size: 0.85em;
        }


        /* ===== ì¸ì‡„ ìµœì í™” ===== */
        @media print {
            body {
                padding: 0;
                margin: 0;
                font-size: 8.2pt;
            }

            body > h1:first-of-type {
                display: none;
            }

            #input-area,
            .button-group,
            .print-download-group {
                display: none;
            }

            #report-area {
                box-shadow: none;
                padding: 2mm 4mm;
                margin: 0;
                border-radius: 0;
                background-color: white;
            }

            #report-area h1 {
                font-size: 1.6em;
                padding-bottom: 6px;
                margin-bottom: 3px;
            }

            .usage-section {
                margin-bottom: 3px;
                padding: 4px;
                page-break-inside: avoid;
            }

            .asset-section-container,
            .summary-section {
                margin-bottom: 2px;
                padding: 4px;
                page-break-inside: avoid;
            }

            .dynamic-column-layout {
                gap: 6px;
                margin-top: 5px;
            }

            .dynamic-column-layout > div {
                min-height: 110px;
                padding: 3px;
                font-size: 0.85em;
            }

            .column-title {
                font-size: 0.9em;
                margin-bottom: 5px;
            }

            .activity-title {
                margin-top: 10px;
                margin-bottom: 8px;
                font-size: 1.2em;
            }

            .summary-section {
                padding: 8px;
                margin-top: 10px;
            }

            .summary-section h3 {
                margin-top: 8px;
                margin-bottom: 3px;
                font-size: 1.05em;
            }

            .summary-textarea {
                min-height: 40px;
                font-size: 0.9em;
            }

            .auto-summary-area {
                padding: 8px;
                font-size: 0.9em;
            }

            .student-review-area label {
                margin-top: 5px;
                margin-bottom: 3px;
                font-size: 0.85em;
            }

            .student-review-area textarea {
                min-height: 35px;
                padding: 4px;
                font-size: 0.8em;
                margin-bottom: 5px !important;
            }

            .student-review-area textarea:last-child {
                margin-bottom: 0 !important;
            }

            .report-footer {
                margin-top: 10px;
                padding-top: 5px;
                font-size: 8pt;
            }

            .badge-item-display {
                width: 60px;
                font-size: 7pt;
            }

            .badge-item-display img {
                width: 40px;
                height: 40px;
            }

            .pie-chart {
                width: 70px;
                height: 70px;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .pie-chart > div {
                font-size: 0.9em !important;
            }

            .cookie-asset-info {
                padding: 0 5px;
            }

            .cookie-asset-item {
                font-size: 0.8em;
            }
        }

    </style>
</head>
<body>

    <h1>ìƒë‹´ ì¤€ë¹„ ë‹¤í–ˆë‹ˆ?</h1>

    <div id="input-area">
        <input type="text" id="api-key-input" placeholder="ì—¬ê¸°ì— ë‹¤í–ˆë‹ˆ API Key ì…ë ¥ (í•„ìˆ˜)" required>
        
        <div class="mode-selection">
            <div id="tab-single" class="mode-tab active" onclick="setMode('single')">ğŸ‘¤ ê°œë³„ í•™ìƒ ì¡°íšŒ</div>
            <div id="tab-batch" class="mode-tab" onclick="setMode('batch')">ğŸ§‘â€ğŸ¤â€ğŸ§‘ ì „ì²´ í•™ìƒ ì¼ê´„ ì¡°íšŒ</div>
        </div>

        <div id="mode-content-area">
            
            <div id="mode-single-content">
                <input type="text" id="student-code-input" placeholder="ì—¬ê¸°ì— í•™ìƒ ì½”ë“œ ì…ë ¥ (í•„ìˆ˜)" required>
            </div>
            <div id="mode-batch-content" style="display: none;">
                <div class="control-group" style="background-color: #fffde7; border-color: #ffeb3b;">
                    <h4>ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„ëœ í•™ìƒ ì½”ë“œ ì…ë ¥</h4>
                    <p style="font-size: 0.9em; color: #a1887f;">* ì „ì²´ í•™ìƒ ì½”ë“œë¥¼ ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„í•˜ì—¬ í•œ ì¤„ì— ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: A1000, A1001, A1002...)</p>
                    <textarea id="code-list-input" rows="6" placeholder="A1001, A1002, A1003, ..."></textarea>
                </div>
            </div>
            
            <div class="config-section" style="background-color: #e8f5e9; border-color: #66bb6a;">
                <h3>âœ… í•„ìˆ˜ ì…ë ¥: ìš°ë¦¬ í•™ê¸‰ì˜ ë‹¤í–ˆë‹ˆ ë‹¤í–ˆì–´ìš” í™œìš© ë°©ì•ˆ</h3>
                <p style="font-size: 0.9em; color: #777;">* ìˆ˜ì •í•´ì„œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                <textarea id="input-usage-general" rows="3" placeholder="ì˜ˆì‹œ: ìš°ë¦¬ í•™ê¸‰ì€ ë‹¤í–ˆë‹ˆ ë‹¤í–ˆì–´ìš”ë¥¼ íƒœë¸”ë¦¿ í™œìš© ìˆ˜ì—…ì˜ ë©”ì¸ í”Œë«í¼ìœ¼ë¡œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. í•™ìƒë“¤ì€ í•™ê¸‰ ìƒí™œ, ìˆ˜ì—… ì°¸ì—¬, ê³¼ì œ ìˆ˜í–‰ ë“±ì— ë”°ë¼ ì¿ í‚¤, ì´ˆì½”ì¹©, ë±ƒì§€ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤." required></textarea>
            </div>


            <div class="config-section">
                <h3>ğŸ“‹ ì„±ì¥ ê¸°ë¡ ë³´ê³ ì„œ ì¶œë ¥ í•­ëª© ì„ íƒ</h3>
                <p style="font-size: 0.9em; color: #777;">* í•­ëª©ì„ ì²´í¬í•˜ë©´ ê´€ë ¨ í™œìš© ë°©ì•ˆ ì…ë ¥ë€ì´ í™œì„±í™”ë©ë‹ˆë‹¤. í•˜ìœ„ í•­ëª©ê¹Œì§€ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                
                <div class="output-option-group" id="option-group-cookie">
                    <label>
                        <input type="checkbox" id="check-output-cookie" checked onchange="toggleConfigGroup('cookie')">
                        ğŸª ì¿ í‚¤ í™œë™ ì „ì²´ ì¶œë ¥
                    </label>
                    
                    <div id="cookie-config-details" class="sub-options">
                        <label>
                            <input type="checkbox" id="check-output-cookie-usage" checked>
                            ìš°ë¦¬ í•™ê¸‰ ì¿ í‚¤ íšë“ ë° ì‚¬ìš©
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-cookie-asset" checked>
                            ì¿ í‚¤ ìì‚° í˜„í™© (ìˆ˜ì…/ì§€ì¶œ/ì”ì—¬)
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-cookie-review" checked>
                            ë‚˜ì˜ ì¿ í‚¤ í™œë™ ëŒì•„ë³´ê¸° (í•™ìƒ ì…ë ¥ì¹¸)
                        </label>
                        
                        <p style="font-size: 0.9em; color: #777; margin-top: 10px;">* íšë“/ì‚¬ìš© ë‚´ìš©ì„ êµ¬ë¶„í•´ì„œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤. (ì˜ˆ: íšë“: ..., ì‚¬ìš©: ...)</p>
                        <textarea id="input-cookie-usage" rows="4" placeholder="íšë“: ì£¼ì œê¸€ì“°ê¸° ì œì¶œ 2ì¿ í‚¤, ë°›ì•„ì“°ê¸° 1ì¿ í‚¤~3ì¿ í‚¤, ë†€ì´ë§ˆë‹¹ 1ì¿ í‚¤~2ì¿ í‚¤, 1ì¸ 1ì—­ ì›”ê¸‰ 7ì¿ í‚¤~15ì¿ í‚¤.&#10;ì‚¬ìš©: ìë¦¬ ì„ íƒê¶Œ 20ì¿ í‚¤, ê°„ì‹êµí™˜ 5ì¿ í‚¤~10ì¿ í‚¤, ìŒì•…ì¬ìƒê¶Œ 10ì¿ í‚¤."></textarea>
                    </div>
                </div>

                <div class="output-option-group" id="option-group-chip">
                    <label>
                        <input type="checkbox" id="check-output-chip" checked onchange="toggleConfigGroup('chip')">
                        ğŸ« ì´ˆì½”ì¹© í™œë™ ì „ì²´ ì¶œë ¥
                    </label>
                    
                    <div id="chip-config-details" class="sub-options">
                        <label>
                            <input type="checkbox" id="check-output-chip-usage" checked>
                            ìš°ë¦¬ í•™ê¸‰ ì´ˆì½”ì¹© íšë“ ë° ì‚¬ìš©
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-chip-asset" checked>
                            ì´ˆì½”ì¹© ìì‚° í˜„í™© (ì”ì•¡)
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-chip-review" checked>
                            ë‚˜ì˜ ì´ˆì½”ì¹© í™œë™ ëŒì•„ë³´ê¸° (í•™ìƒ ì…ë ¥ì¹¸)
                        </label>

                        <p style="font-size: 0.9em; color: #777; margin-top: 10px;">* íšë“/ì‚¬ìš© ë‚´ìš©ì„ êµ¬ë¶„í•´ì„œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤. (ì˜ˆ: íšë“: ..., ì‚¬ìš©: ...)</p>
                        <textarea id="input-chip-usage" rows="4" placeholder="íšë“: ë°œí‘œ ë‚´ìš©ì´ ì¢‹ì€ í•™ìƒì—ê²Œ 1ì´ˆì½”ì¹©, ê²½ì²­ íƒœë„ê°€ ì¢‹ì€ í•™ìƒì—ê²Œ 1ì´ˆì½”ì¹©.&#10;ì‚¬ìš©: 10ì´ˆì½”ì¹©ì„ 1ì¿ í‚¤ë¡œ êµí™˜í•  ìˆ˜ ìˆìŒ."></textarea>
                    </div>
                </div>

                <div class="output-option-group" id="option-group-badge">
                    <label>
                        <input type="checkbox" id="check-output-badge" checked onchange="toggleConfigGroup('badge')">
                        ğŸ… ë±ƒì§€ í™œë™ ì „ì²´ ì¶œë ¥
                    </label>
                    
                    <div id="badge-config-details" class="sub-options">
                        <label>
                            <input type="checkbox" id="check-output-badge-usage" checked>
                            ìš°ë¦¬ í•™ê¸‰ ë±ƒì§€ ì†Œê°œ ë° íšë“
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-badge-status" checked>
                            í•™ìƒì˜ ë±ƒì§€ íšë“ í˜„í™©
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-badge-strength" style="display: none;">
                        </label>

                        <p style="font-size: 0.9em; color: #777; margin-top: 10px;">* ì†Œê°œ/íšë“ ë‚´ìš©ì„ êµ¬ë¶„í•´ì„œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤. (ì˜ˆ: ì†Œê°œ: ..., íšë“: ...)</p>
                        <textarea id="input-badge-usage" rows="4" placeholder="ì†Œê°œ: ì•„ì¹¨ ë…ì„œ, ë°”ë¥´ê²Œ ê¸€ì”¨ ì“°ê¸°, ì¸ì‚¬ ì˜í•˜ê¸°, í™˜ê²½ë³´í˜¸ ì‹¤ì²œí•˜ê¸°, ë§ˆìŒ ë‹¤ìŠ¤ë¦¬ê¸°, íš¨ë„ë¯¸ì…˜.&#10;íšë“: ì•„ì¹¨ í•œ ì¤„ ë…ì„œë¡ ì“°ê¸° ì™„ì„±, ë°”ë¥¸ ê¸€ì”¨ ì¹­ì°¬ 10íšŒ ì´ìƒ, ë§¤ë‹¬ í•™ê¸‰íšŒì˜ ì‹œê°„ ì¸ì‚¬ì™• ë½‘ê¸°, ì œë¡œì›¨ì´ìŠ¤íŠ¸ ë¯¸ì…˜ í†µê³¼, í˜„ëª…í•˜ê²Œ ê°ˆë“± í•´ê²°í•˜ê¸° 5íšŒ, íš¨ë„ ë¯¸ì…˜í†µê³¼."></textarea>
                    </div>
                </div>
                
                <div class="output-option-group" id="option-group-summary" style="background-color: #fce4ec; border-color: #ec407a;">
                    <label>
                        <input type="checkbox" id="check-output-summary" checked onchange="toggleConfigGroup('summary', false)">
                        ğŸ“Š ì´í‰ ì„¹ì…˜ ì „ì²´ ì¶œë ¥
                    </label>
                    <div id="summary-config-details" class="sub-options">
                        <label>
                            <input type="checkbox" id="check-output-summary-summary" checked style="display: none;"> 
                            í™œë™ ìš”ì•½ (ìë™ ì…ë ¥)
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-summary-strength" checked>
                            ì¹­ì°¬ê³¼ ë‹¤ì§ (í•™ìƒ ì…ë ¥ì¹¸)
                        </label>
                        <label>
                            <input type="checkbox" id="check-output-summary-parent" checked>
                            ê²©ë ¤ì˜ í•œ ë§ˆë”” (í•™ë¶€ëª¨ ì…ë ¥ì¹¸)
                        </label>

                        <p style="font-size: 0.85em; color: #a1887f; margin-top: 10px;">
                            * **í™œë™ ìš”ì•½**ì€ ìë™ìœ¼ë¡œ ì…ë ¥ë˜ë©°, **ì¹­ì°¬ê³¼ ë‹¤ì§**ì€ í•™ìƒ, **ê²©ë ¤ì˜ í•œ ë§ˆë””**ëŠ” í•™ë¶€ëª¨ë‹˜ê»˜ì„œ ì‘ì„±í•˜ëŠ” í•­ëª©ì…ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>

            </div>
        </div>

        <div class="button-group">
            <button id="generate-report-btn" onclick="handleReport()">ğŸ“‹ ì„±ì¥ ê¸°ë¡í‘œ ì¶œë ¥</button>
        </div>
    </div>
    
    <div id="report-area">
        <p class="alert alert-loading">ì¶œë ¥ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì„ íƒí•œ ë°©ì‹ì— ë”°ë¼ ì„±ì¥ ê¸°ë¡ ë³´ê³ ì„œê°€ ìƒì„±ë©ë‹ˆë‹¤.</p>
    </div>

    <div class="print-download-group">
        <button onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„ / PDFë¡œ ì €ì¥</button>
        <button onclick="shareUrl()">ğŸ”— URL ê³µìœ í•˜ê¸°</button>
    </div>


    <script>
        // ============================================================
        // â˜… ìƒìˆ˜ ì •ì˜
        // ============================================================
        const CONFIG = {
            API_BASE_URL: "https://api.dahandin.com/openapi/v1",
            DEFAULT_MODE: 'single',
            RESPONSE_STATUS: {
                SUCCESS: true,
                ERROR: false,
            },
            ROUTE_ENDPOINT: '/get/student/total',
        };

        const BADGE_LIST = [
            { title: "ì„±ì‹¤", imgUrl: "https://i.imgur.com/badge_sungsil.png" },
            { title: "ìš©ê¸°", imgUrl: "https://i.imgur.com/badge_yonggi.png" },
            { title: "ì±…ì„", imgUrl: "https://i.imgur.com/badge_chaegim.png" },
            { title: "ì¹­ì°¬ì™•", imgUrl: "https://i.imgur.com/badge_chingchan.png" },
            { title: "ë°°ë ¤", imgUrl: "https://i.imgur.com/badge_baeryeo.png" },
            { title: "ì •ì§", imgUrl: "https://i.imgur.com/badge_jungjik.png" },
            { title: "í˜‘ë™", imgUrl: "https://i.imgur.com/badge_hyeopdong.png" },
            { title: "ì°½ì˜", imgUrl: "https://i.imgur.com/badge_changui.png" },
            { title: "ë´‰ì‚¬", imgUrl: "https://i.imgur.com/badge_bongsa.png" },
        ];

        const DEFAULT_USAGE_TEXTS = {
            general: "ìš°ë¦¬ í•™ê¸‰ì€ ë‹¤í–ˆë‹ˆ ë‹¤í–ˆì–´ìš”ë¥¼ íƒœë¸”ë¦¿ í™œìš© ìˆ˜ì—…ì˜ ë©”ì¸ í”Œë«í¼ìœ¼ë¡œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. í•™ìƒë“¤ì€ í•™ê¸‰ ìƒí™œ, ìˆ˜ì—… ì°¸ì—¬, ê³¼ì œ ìˆ˜í–‰ ë“±ì— ë”°ë¼ ì¿ í‚¤, ì´ˆì½”ì¹©, ë±ƒì§€ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤.",
            cookieUsage: "íšë“: ì£¼ì œê¸€ì“°ê¸° ì œì¶œ 2ì¿ í‚¤, ë°›ì•„ì“°ê¸° 1ì¿ í‚¤~3ì¿ í‚¤, ë†€ì´ë§ˆë‹¹ 1ì¿ í‚¤~2ì¿ í‚¤, 1ì¸ 1ì—­ ì›”ê¸‰ 7ì¿ í‚¤~15ì¿ í‚¤ \nì‚¬ìš©: ìë¦¬ ì„ íƒê¶Œ 20ì¿ í‚¤, ê°„ì‹êµí™˜ 5ì¿ í‚¤~10ì¿ í‚¤, ìŒì•…ì¬ìƒê¶Œ 10ì¿ í‚¤",
            chipUsage: "íšë“: ë°œí‘œ ë‚´ìš©ì´ ì¢‹ì€ í•™ìƒì—ê²Œ 1ì´ˆì½”ì¹©, ê²½ì²­ íƒœë„ê°€ ì¢‹ì€ í•™ìƒì—ê²Œ 1ì´ˆì½”ì¹©. \nì‚¬ìš©: 10ì´ˆì½”ì¹©ì„ 1ì¿ í‚¤ë¡œ êµí™˜í•  ìˆ˜ ìˆìŒ.",
            badgeUsage: "ì†Œê°œ: ì•„ì¹¨ ë…ì„œ, ë°”ë¥´ê²Œ ê¸€ì”¨ ì“°ê¸°, ì¸ì‚¬ ì˜í•˜ê¸°, í™˜ê²½ë³´í˜¸ ì‹¤ì²œí•˜ê¸°, ë§ˆìŒ ë‹¤ìŠ¤ë¦¬ê¸°, íš¨ë„ë¯¸ì…˜ \níšë“: ì•„ì¹¨ í•œ ì¤„ ë…ì„œë¡ ì“°ê¸° ì™„ì„±, ë°”ë¥¸ ê¸€ì”¨ ì¹­ì°¬ 10íšŒ ì´ìƒ, ë§¤ë‹¬ í•™ê¸‰íšŒì˜ ì‹œê°„ ì¸ì‚¬ì™• ë½‘ê¸°, ì œë¡œì›¨ì´ìŠ¤íŠ¸ ë¯¸ì…˜ í†µê³¼, í˜„ëª…í•˜ê²Œ ê°ˆë“± í•´ê²°í•˜ê¸° 5íšŒ, íš¨ë„ ë¯¸ì…˜í†µê³¼"
        };

        // ============================================================
        // â˜… ìƒíƒœ ê´€ë¦¬
        // ============================================================
        const STATE = {
            currentMode: CONFIG.DEFAULT_MODE,
            cumulativeBadges: {},
        };

        const ELEMENT_IDS = {
            apiKeyInput: 'api-key-input',
            studentCodeInput: 'student-code-input',
            codeListInput: 'code-list-input',
            generateBtn: 'generate-report-btn',
            reportArea: 'report-area',
            modeTab: {
                single: 'tab-single',
                batch: 'tab-batch',
            },
            modeContent: {
                single: 'mode-single-content',
                batch: 'mode-batch-content',
            },
        }; 

        // ============================================================
        // â˜… ëª¨ë“œ ì „í™˜ í•¨ìˆ˜
        // ============================================================
        const setMode = (mode) => {
            STATE.currentMode = mode;

            const { single: singleTabId, batch: batchTabId } = ELEMENT_IDS.modeTab;
            const { single: singleContentId, batch: batchContentId } = ELEMENT_IDS.modeContent;

            document.getElementById(singleTabId).classList.remove('active');
            document.getElementById(batchTabId).classList.remove('active');
            document.getElementById(singleContentId).style.display = 'none';
            document.getElementById(batchContentId).style.display = 'none';

            if (mode === 'single') {
                document.getElementById(singleTabId).classList.add('active');
                document.getElementById(singleContentId).style.display = 'block';
            } else {
                document.getElementById(batchTabId).classList.add('active');
                document.getElementById(batchContentId).style.display = 'block';
            }

            const buttonText = mode === 'single' ? 'ğŸ“‹ ì„±ì¥ ê¸°ë¡í‘œ ì¶œë ¥' : 'ğŸ“‚ ì¼ê´„ ì„±ì¥ ê¸°ë¡í‘œ ì¶œë ¥';
            document.getElementById(ELEMENT_IDS.generateBtn).innerText = buttonText;
            document.getElementById(ELEMENT_IDS.reportArea).innerHTML = '<p class="alert alert-loading">ì¶œë ¥ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì„ íƒí•œ ë°©ì‹ì— ë”°ë¼ ì„±ì¥ ê¸°ë¡ ë³´ê³ ì„œê°€ ìƒì„±ë©ë‹ˆë‹¤.</p>';
        };

        // ============================================================
        // â˜… ì„¤ì • ê·¸ë£¹ í† ê¸€ í•¨ìˆ˜
        // ============================================================
        const toggleConfigGroup = (groupName, isAssetGroup = true) => {
            const masterCheckId = `check-output-${groupName}`;
            const detailContainerId = `${groupName}-config-details`;
            const masterCheck = document.getElementById(masterCheckId);
            const detailContainer = document.getElementById(detailContainerId);

            detailContainer.style.display = masterCheck.checked ? 'block' : 'none';

            if (isAssetGroup) {
                const subCheckboxes = detailContainer.querySelectorAll('input[type="checkbox"]');
                subCheckboxes.forEach(subCheck => {
                    subCheck.checked = masterCheck.checked;
                });
            }
        };

        // ============================================================
        // â˜… DOM ì´ˆê¸°í™” í•¨ìˆ˜
        // ============================================================
        const initializeDOM = () => {
            setMode('single');

            document.getElementById('input-usage-general').value = DEFAULT_USAGE_TEXTS.general;
            document.getElementById('input-cookie-usage').value = DEFAULT_USAGE_TEXTS.cookieUsage;
            document.getElementById('input-chip-usage').value = DEFAULT_USAGE_TEXTS.chipUsage;
            document.getElementById('input-badge-usage').value = DEFAULT_USAGE_TEXTS.badgeUsage;

            toggleConfigGroup('cookie');
            toggleConfigGroup('chip');
            toggleConfigGroup('badge');
            document.getElementById('check-output-badge-strength').checked = false;
            toggleConfigGroup('summary', false);
        };

        // ============================================================
        // â˜… ì„¤ì • ì¡°íšŒ í•¨ìˆ˜
        // ============================================================
        const getReportConfig = () => {
            const cookieUsageElem = document.getElementById('input-cookie-usage');
            const chipUsageElem = document.getElementById('input-chip-usage');
            const badgeUsageElem = document.getElementById('input-badge-usage');

            return {
                generalUsage: document.getElementById('input-usage-general').value.trim(),
                cookie: document.getElementById('check-output-cookie').checked ? {
                    usage: document.getElementById('check-output-cookie-usage').checked ? (cookieUsageElem?.value.trim() || DEFAULT_USAGE_TEXTS.cookieUsage) : null,
                    asset: document.getElementById('check-output-cookie-asset').checked,
                    review: document.getElementById('check-output-cookie-review').checked,
                } : null,
                chip: document.getElementById('check-output-chip').checked ? {
                    usage: document.getElementById('check-output-chip-usage').checked ? (chipUsageElem?.value.trim() || DEFAULT_USAGE_TEXTS.chipUsage) : null,
                    asset: document.getElementById('check-output-chip-asset').checked,
                    review: document.getElementById('check-output-chip-review').checked,
                } : null,
                badge: document.getElementById('check-output-badge').checked ? {
                    usage: document.getElementById('check-output-badge-usage').checked ? (badgeUsageElem?.value.trim() || DEFAULT_USAGE_TEXTS.badgeUsage) : null,
                    status: document.getElementById('check-output-badge-status').checked,
                    strength: false,
                } : null,
                summary: document.getElementById('check-output-summary').checked ? {
                    output: document.getElementById('check-output-summary').checked,
                    summary: true,
                    praiseAndResolve: document.getElementById('check-output-summary-strength').checked,
                    parentComment: document.getElementById('check-output-summary-parent').checked,
                } : null,
            };
        };

        // ============================================================
        // â˜… ë±ƒì§€ ê´€ë¦¬ í•¨ìˆ˜
        // ============================================================
        const archiveAndRetrieveCumulativeBadges = (studentCode, liveBadges) => {
            if (!STATE.cumulativeBadges[studentCode]) {
                STATE.cumulativeBadges[studentCode] = {};
            }

            if (liveBadges && typeof liveBadges === 'object') {
                Object.values(liveBadges).forEach(badge => {
                    if (badge?.hasBadge) {
                        STATE.cumulativeBadges[studentCode][badge.title] = {
                            title: badge.title,
                            imgUrl: badge.imgUrl || BADGE_LIST.find(b => b.title === badge.title)?.imgUrl || 'placeholder_badge.png',
                            hasBadge: true
                        };
                    }
                });
            }

            return Object.values(STATE.cumulativeBadges[studentCode]);
        };

        // ============================================================
        // â˜… ë³´ê³ ì„œ ë°ì´í„° ìƒì„± í•¨ìˆ˜
        // ============================================================
        const generatePraiseSummary = (studentName, report) => {
            const { totalCookieIncome, currentChocoChips, allAcquiredBadges } = report;
            const earnedBadgeTitles = allAcquiredBadges.map(badge => badge.title);
            const badgeTitlesString = earnedBadgeTitles.length > 0 
                ? `(${earnedBadgeTitles.join(', ')})` 
                : '(íšë“í•œ ë±ƒì§€ ì—†ìŒ)';

            return {
                autoSummary: `${studentName} í•™ìƒì€ ìš°ë¦¬ í•™ê¸‰ ë‹¤í–ˆë‹ˆ ë‹¤í–ˆì–´ìš” í™œë™ì„ í†µí•´\n*ì¿ í‚¤(${totalCookieIncome}ê°œ), *ì´ˆì½”ì¹©(${currentChocoChips}ê°œ), *ë±ƒì§€${badgeTitlesString}ë¥¼ íšë“í•˜ì˜€ìŠµë‹ˆë‹¤.`,
                praiseAndResolve: `[êµì‚¬ ì°¸ê³ ] ì´ ìë¦¬ì— ì„ ìƒë‹˜ì´ ëŒ€ì‹  ì¹­ì°¬ê³¼ ê²©ë ¤ì˜ ë©”ì‹œì§€ë¥¼ ì ê±°ë‚˜, í•™ìƒì´ ì§ì ‘ ì˜í•œ ì ê³¼ ë‹¤ì§ì„ ì ì„ ìˆ˜ ìˆë„ë¡ ì•ˆë‚´í•´ì£¼ì„¸ìš”.`,
            };
        };

        const calculateCookieRatio = (cookieIncome, cookieUsed) => {
            if (cookieIncome <= 0) {
                return { usage: 0, saving: 0 };
            }

            const usageRatio = (cookieUsed / cookieIncome) * 100;
            return {
                usage: parseFloat(usageRatio.toFixed(1)),
                saving: parseFloat((100 - usageRatio).toFixed(1)),
            };
        };

        // ============================================================
        // â˜… API í˜¸ì¶œ í•¨ìˆ˜
        // ============================================================
        const fetchStudentData = async (studentCode, apiKey) => {
            const endpoint = `${CONFIG.API_BASE_URL}${CONFIG.ROUTE_ENDPOINT}?code=${studentCode}`;

            try {
                if (!apiKey || !studentCode) {
                    return { error: "API Keyì™€ í•™ìƒ ì½”ë“œê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤." };
                }

                const response = await fetch(endpoint, {
                    method: "GET",
                    headers: { "X-API-Key": apiKey }
                });

                if (!response.ok) {
                    return { error: `API í˜¸ì¶œ ì‹¤íŒ¨ (ìƒíƒœ ì½”ë“œ: ${response.status})` };
                }

                const json = await response.json();
                return json.result === true
                    ? json.data
                    : { error: json.message || "ì•Œ ìˆ˜ ì—†ëŠ” API ì‘ë‹µ ì˜¤ë¥˜" };
            } catch (error) {
                return { error: "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ì„œë²„ ì ‘ì† ì‹¤íŒ¨" };
            }
        };

        const generateStudentReport = async (studentCode, apiKey, config) => {
            const liveData = await fetchStudentData(studentCode, apiKey);

            if (liveData.error) {
                return { error: liveData.error };
            }

            const totalCookieIncome = liveData.cookie || 0;
            const totalCookieUsed = liveData.usedCookie || 0;
            const currentChocoChips = liveData.chocoChips || 0;
            const allAcquiredBadges = archiveAndRetrieveCumulativeBadges(studentCode, liveData.badges);
            const { usage: cookieUsageRatio, saving: cookieSavingRatio } = calculateCookieRatio(totalCookieIncome, totalCookieUsed);

            const report = {
                student: liveData.name || "í•™ìƒ",
                reportDate: new Date().toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }),
                config,
                allAcquiredBadges,
                studentCode,
                totalCookieIncome,
                totalCookieUsed,
                currentChocoChips,
                cookieUsageRatio,
                cookieSavingRatio,
            };

            report.analysis = generatePraiseSummary(report.student, report);
            return report;
        };

        // ============================================================
        // â˜… URL ê³µìœ  í•¨ìˆ˜
        // ============================================================
        const shareUrl = async () => {
            const url = window.location.href;
            
            if (!navigator.clipboard) {
                alert(`í´ë¦½ë³´ë“œ APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” í™˜ê²½ì…ë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”: ${url}`);
                return;
            }

            try {
                await navigator.clipboard.writeText(url);
                alert("í˜„ì¬ ë³´ê³ ì„œì˜ URLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! (ì£¼ì˜: ë¡œì»¬ íŒŒì¼ ì‹¤í–‰ ì‹œ URL ê³µìœ ê°€ ë¶ˆê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤)");
            } catch (err) {
                alert(`URL ë³µì‚¬ ì‹¤íŒ¨. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”: ${url}`);
            }
        };

        // ============================================================
        // â˜… ë³´ê³ ì„œ ìƒì„± í•¸ë“¤ëŸ¬
        // ============================================================
        const handleReport = async () => {
            const apiKey = document.getElementById(ELEMENT_IDS.apiKeyInput).value.trim();
            const reportArea = document.getElementById(ELEMENT_IDS.reportArea);
            const config = getReportConfig();

            const setErrorMessage = (message) => {
                reportArea.innerHTML = `<p class="alert alert-error">${message}</p>`;
            };

            if (!apiKey) {
                setErrorMessage("API Keyë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            if (!config.generalUsage) {
                setErrorMessage("í•„ìˆ˜ ì…ë ¥ í•­ëª©ì¸ \"í™œìš© ë°©ì•ˆ\"ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            let studentCodes = [];

            if (STATE.currentMode === 'single') {
                const studentCode = document.getElementById(ELEMENT_IDS.studentCodeInput).value.trim();
                if (!studentCode) {
                    setErrorMessage("í•™ìƒ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    return;
                }
                studentCodes.push(studentCode);
            } else if (STATE.currentMode === 'batch') {
                const codeListText = document.getElementById(ELEMENT_IDS.codeListInput).value.trim();
                if (!codeListText) {
                    setErrorMessage("í•™ìƒ ì½”ë“œ ëª©ë¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    return;
                }
                studentCodes = codeListText
                    .split(',')
                    .map(code => code.trim())
                    .filter(code => code.length > 0);
            }

            const generateBtn = document.getElementById(ELEMENT_IDS.generateBtn);
            generateBtn.disabled = true;
            reportArea.innerHTML = '<p class="alert alert-loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>';

            let allReportsHtml = '';

            for (const code of studentCodes) {
                const reportData = await generateStudentReport(code, apiKey, config);
                if (reportData.error) {
                    allReportsHtml += `<div class="report-error-block"><h2>âš ï¸ ì˜¤ë¥˜: í•™ìƒ ì½”ë“œ ${code}</h2><p>${reportData.error}</p></div>`;
                } else {
                    allReportsHtml += generateReportHtml(reportData, studentCodes.length > 1);
                }
            }

            reportArea.innerHTML = allReportsHtml;
            generateBtn.disabled = false;
        };

        // ============================================================
        // â˜… íŒŒì´ ì°¨íŠ¸ ìŠ¤íƒ€ì¼ ìƒì„± í•¨ìˆ˜
        // ============================================================
        const COLOR_PALETTE = {
            SAVE: '#2ecc71',
            USE: '#e74c3c',
        };

        const generatePieChartStyle = (savingRatio, usageRatio) => {
            return `background: conic-gradient(${COLOR_PALETTE.SAVE} 0% ${savingRatio}%, ${COLOR_PALETTE.USE} ${savingRatio}% 100%);`;
        };

        // ============================================================
        // â˜… í…ìŠ¤íŠ¸ ë¶„í•  í•¨ìˆ˜
        // ============================================================
        /**
         * ì…ë ¥ í…ìŠ¤íŠ¸ë¥¼ íŠ¹ì • í‚¤ì›Œë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬í•©ë‹ˆë‹¤.
         * @param {string} inputText - ì…ë ¥ í…ìŠ¤íŠ¸
         * @param {string} primaryKeyword - ì²« ë²ˆì§¸ í‚¤ì›Œë“œ (ì˜ˆ: 'íšë“')
         * @param {string} secondaryKeyword - ë‘ ë²ˆì§¸ í‚¤ì›Œë“œ (ì˜ˆ: 'ì‚¬ìš©')
         * @returns {Object} { primary, secondary } ë¶„ë¦¬ëœ í…ìŠ¤íŠ¸
         */
        const splitUsageText = (inputText, primaryKeyword, secondaryKeyword) => {
            const input = inputText || '';
            let primaryContent = 'ë‚´ìš© ì—†ìŒ';
            let secondaryContent = 'ë‚´ìš© ì—†ìŒ';

            const primaryRegex = new RegExp(`${primaryKeyword}:(.*?)(?:\\n${secondaryKeyword}:|$)`, 's');
            const secondaryRegex = new RegExp(`${secondaryKeyword}:(.*)`, 's');

            const matchPrimary = input.match(primaryRegex);
            const matchSecondary = input.match(secondaryRegex);

            if (matchPrimary?.at(1)) {
                primaryContent = matchPrimary[1].trim();
            } else if (input.trim().startsWith(`${primaryKeyword}:`)) {
                primaryContent = input.replace(`${primaryKeyword}:`, '').trim();
            }

            if (matchSecondary?.at(1)) {
                secondaryContent = matchSecondary[1].trim();
            }

            return { primary: primaryContent, secondary: secondaryContent };
        };

        // ============================================================
        // â˜… ë³´ê³ ì„œ HTML ìƒì„± í•¨ìˆ˜
        // ============================================================
        const generateReportHtml = (report, isBatchMode) => {
            const { student, reportDate, config, allAcquiredBadges, totalCookieIncome, totalCookieUsed, currentChocoChips, cookieSavingRatio, cookieUsageRatio } = report;
            const { cookie, chip, badge, summary } = config;

            const createReportHeader = () => `
                <div class="report-page" style="page-break-after: ${isBatchMode ? 'always' : 'auto'};">
                    <h1>âœ¨ ${student} í•™ìƒì˜ ì„±ì¥ ê¸°ë¡ âœ¨</h1>
                    <div class="usage-section">
                        <h2>ğŸ“Œ ìš°ë¦¬ í•™ê¸‰ì˜ ë‹¤í–ˆë‹ˆ ë‹¤í–ˆì–´ìš” í™œìš© ë°©ì•ˆ</h2>
                        <div class="usage-text">${config.generalUsage}</div>
                    </div>
            `;

            const createCookieSection = () => {
                if (!cookie) return '';

                const { primary: acquisition, secondary: use } = splitUsageText(cookie.usage, 'íšë“', 'ì‚¬ìš©');
                const cookieBalance = totalCookieIncome - totalCookieUsed;

                let section = `
                    <div class="asset-section-container">
                        <h2 class="activity-title">ğŸª ${student} í•™ìƒì˜ ì¿ í‚¤ í™œë™</h2>
                        <div class="dynamic-column-layout">
                `;

                if (cookie.usage) {
                    section += `
                        <div style="flex: 1 1 30%;">
                            <div class="column-title">ğŸª ìš°ë¦¬ í•™ê¸‰ ì¿ í‚¤ íšë“ ë° ì‚¬ìš©</div>
                            <div class="usage-content-block" style="border-bottom: 1px dashed #ccc; padding-bottom: 10px; margin-bottom: 10px; line-height: 1.4;">
                                <p style="font-weight: bold; color: #2ecc71; margin-bottom: 5px; font-size: 1em;">íšë“</p>
                                <p style="white-space: pre-wrap; font-size: 0.9em;">${acquisition}</p>
                            </div>
                            <div class="usage-content-block" style="border-bottom: none; margin-bottom: 0; padding-bottom: 0; line-height: 1.4;">
                                <p style="font-weight: bold; color: #e74c3c; margin-bottom: 5px; font-size: 1em;">ì‚¬ìš©</p>
                                <p style="white-space: pre-wrap; font-size: 0.9em;">${use}</p>
                            </div>
                        </div>
                    `;
                }

                if (cookie.asset) {
                    section += `
                        <div style="flex: 1 1 30%;">
                            <div class="column-title">ğŸ’° ì¿ í‚¤ ìì‚° í˜„í™©</div>
                            <div class="center-asset-content">
                                <div class="graph-container">
                                    <div class="pie-chart" style="${generatePieChartStyle(cookieSavingRatio, cookieUsageRatio)}">
                                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.1em; font-weight: bold; color: #333;">
                                            ${cookieSavingRatio}%
                                            <div style="font-size: 0.7em; font-weight: normal; color: #777;">(ì €ì¶•)</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="cookie-asset-info">
                                    <div class="cookie-asset-item"><span>ì´ íšë“ (ìˆ˜ì…)</span> <span>${totalCookieIncome}ê°œ</span></div>
                                    <div class="cookie-asset-item"><span>ì´ ì‚¬ìš© (ì§€ì¶œ)</span> <span>${totalCookieUsed}ê°œ</span></div>
                                    <div class="cookie-asset-item"><span>ë‚¨ì€ ì¿ í‚¤ (ì”ì—¬)</span> <span>${cookieBalance}ê°œ</span></div>
                                </div>
                            </div>
                        </div>
                    `;
                }

                if (cookie.review) {
                    section += `
                        <div style="flex: 1 1 40%;">
                            <div class="column-title">ğŸª ë‚˜ì˜ ì¿ í‚¤ í™œë™ ëŒì•„ë³´ê¸°</div>
                            <div class="student-review-area">
                                <label>1. ì¿ í‚¤ íšë“ ë¹„ë²•:</label>
                                <textarea placeholder=""></textarea>
                                <label>2. ì¢‹ì•˜ë˜ ì :</label>
                                <textarea placeholder=""></textarea>
                            </div>
                        </div>
                    `;
                }

                section += '</div></div>';
                return section;
            };

            const createChipSection = () => {
                if (!chip) return '';

                const { primary: acquisition, secondary: use } = splitUsageText(chip.usage, 'íšë“', 'ì‚¬ìš©');

                let section = `
                    <div class="asset-section-container">
                        <h2 class="activity-title">ğŸ« ${student} í•™ìƒì˜ ì´ˆì½”ì¹© í™œë™</h2>
                        <div class="dynamic-column-layout">
                `;

                if (chip.usage) {
                    section += `
                        <div style="flex: 1 1 30%;">
                            <div class="column-title">ğŸ« ìš°ë¦¬ í•™ê¸‰ ì´ˆì½”ì¹© íšë“ ë° ì‚¬ìš©</div>
                            <div class="usage-content-block" style="border-bottom: 1px dashed #ccc; padding-bottom: 10px; margin-bottom: 10px; line-height: 1.4;">
                                <p style="font-weight: bold; color: #2ecc71; margin-bottom: 5px; font-size: 1em;">íšë“</p>
                                <p style="white-space: pre-wrap; font-size: 0.9em;">${acquisition}</p>
                            </div>
                            <div class="usage-content-block" style="border-bottom: none; margin-bottom: 0; padding-bottom: 0; line-height: 1.4;">
                                <p style="font-weight: bold; color: #e74c3c; margin-bottom: 5px; font-size: 1em;">ì‚¬ìš©</p>
                                <p style="white-space: pre-wrap; font-size: 0.9em;">${use}</p>
                            </div>
                        </div>
                    `;
                }

                if (chip.asset) {
                    section += `
                        <div style="flex: 1 1 30%;">
                            <div class="column-title">ğŸ« ì´ˆì½”ì¹© ìì‚° í˜„í™© (ì”ì•¡)</div>
                            <div class="center-asset-content">
                                <h3 style="color: #d35400; font-size: 2.5em; margin: 20px 0;">${currentChocoChips}ê°œ</h3>
                            </div>
                        </div>
                    `;
                }

                if (chip.review) {
                    section += `
                        <div style="flex: 1 1 40%;">
                            <div class="column-title">ğŸ« ë‚˜ì˜ ì´ˆì½”ì¹© í™œë™ ëŒì•„ë³´ê¸°</div>
                            <div class="student-review-area">
                                <label>1. ì´ˆì½”ì¹© íšë“ ë¹„ë²•:</label>
                                <textarea placeholder=""></textarea>
                                <label>2. ì¢‹ì•˜ë˜ ì :</label>
                                <textarea placeholder=""></textarea>
                            </div>
                        </div>
                    `;
                }

                section += '</div></div>';
                return section;
            };

            const createBadgeSection = () => {
                if (!badge) return '';

                const { primary: introduction, secondary: acquisition } = splitUsageText(badge.usage, 'ì†Œê°œ', 'íšë“');
                const badgesHtml = allAcquiredBadges.length > 0
                    ? allAcquiredBadges.map(b => `
                        <div class="badge-item-display acquired">
                            <img src="${b.imgUrl}" alt="${b.title} ë±ƒì§€">
                            <span>${b.title}</span>
                        </div>
                    `).join('')
                    : '<p style="text-align: center; font-size: 0.9em; color: #777; width: 100%; margin: 10px 0;">ì•„ì§ íšë“í•œ ë±ƒì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';

                let section = `
                    <div class="asset-section-container">
                        <h2 class="activity-title">ğŸ… ${student} í•™ìƒì˜ ë±ƒì§€ í™œë™</h2>
                        <div class="dynamic-column-layout">
                `;

                if (badge.usage) {
                    section += `
                        <div style="flex: 1 1 30%;">
                            <div class="column-title">ğŸ… ìš°ë¦¬ í•™ê¸‰ ë±ƒì§€ ì†Œê°œ ë° íšë“</div>
                            <div class="usage-content-block" style="border-bottom: 1px dashed #ccc; padding-bottom: 10px; margin-bottom: 10px; line-height: 1.4;">
                                <p style="font-weight: bold; color: #1e88e5; margin-bottom: 5px; font-size: 1em;">ì†Œê°œ</p>
                                <p style="white-space: pre-wrap; font-size: 0.9em;">${introduction}</p>
                            </div>
                            <div class="usage-content-block" style="border-bottom: none; margin-bottom: 0; padding-bottom: 0; line-height: 1.4;">
                                <p style="font-weight: bold; color: #2ecc71; margin-bottom: 5px; font-size: 1em;">íšë“</p>
                                <p style="white-space: pre-wrap; font-size: 0.9em;">${acquisition}</p>
                            </div>
                        </div>
                    `;
                }

                if (badge.status) {
                    section += `
                        <div style="flex: 1 1 30%;">
                            <div class="column-title">ğŸ… í•™ìƒì˜ ë±ƒì§€ íšë“ í˜„í™©</div>
                            <div class="all-badges-container">${badgesHtml}</div>
                        </div>
                        <div style="flex: 1 1 40%;">
                            <div class="column-title">ğŸ… ë‚˜ì˜ ë±ƒì§€ í™œë™ ëŒì•„ë³´ê¸°</div>
                            <div class="student-review-area">
                                <label>1. ê°€ì¥ ìë‘ìŠ¤ëŸ¬ìš´ ë±ƒì§€ì™€ ê·¸ ì´ìœ :</label>
                                <textarea placeholder=""></textarea>
                                <label>2. ë‚´ê°€ ë°›ê³  ì‹¶ì€ ë±ƒì§€ ì¶”ì²œ:</label>
                                <textarea placeholder=""></textarea>
                            </div>
                        </div>
                    `;
                }

                section += '</div></div>';
                return section;
            };

            const createSummarySection = () => {
                if (!summary) return '';

                let section = '<div class="summary-section"><h2>ğŸ“Š ì´í‰</h2>';

                if (summary.summary) {
                    section += `
                        <h3>1. í™œë™ ìš”ì•½</h3>
                        <div class="auto-summary-area">${report.analysis.autoSummary}</div>
                    `;
                }

                if (summary.praiseAndResolve) {
                    section += `
                        <h3>2. ì¹­ì°¬ê³¼ ë‹¤ì§</h3>
                        <textarea class="summary-textarea" rows="4" placeholder="í•™ìƒ ì…ë ¥: ìŠ¤ìŠ¤ë¡œ ì˜í•œ ë¶€ë¶„ì„ ì¹­ì°¬í•˜ê³  ì•ìœ¼ë¡œì˜ ë‹¤ì§ì„ ì ì–´ë´…ì‹œë‹¤."></textarea>
                    `;
                }

                if (summary.parentComment) {
                    section += `
                        <h3>3. ê²©ë ¤ì˜ í•œ ë§ˆë””</h3>
                        <textarea class="summary-textarea" rows="4" placeholder="í•™ë¶€ëª¨ ì…ë ¥ : ìë…€ë¥¼ ìœ„í•œ ê²©ë ¤ì˜ í•œ ë§ˆë””ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”."></textarea>
                    `;
                }

                section += '</div>';
                return section;
            };

            const createFooter = () => `
                <div class="report-footer">ì¡°íšŒ ì¼ì‹œ: ${reportDate}</div>
                </div>
            `;

            return (
                createReportHeader() +
                createCookieSection() +
                createChipSection() +
                createBadgeSection() +
                createSummarySection() +
                createFooter()
            );
        };

        // ============================================================
        // â˜… DOM ë¡œë“œ ì™„ë£Œ ì‹œ ì´ˆê¸°í™”
        // ============================================================
        document.addEventListener('DOMContentLoaded', initializeDOM);
    </script>
</body>
</html>